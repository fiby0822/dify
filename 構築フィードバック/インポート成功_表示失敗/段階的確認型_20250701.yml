app:
  description: å•ã„åˆã‚ã›å†…å®¹ã‚’æ®µéšŽçš„ã«ç¢ºèªã—ãªãŒã‚‰ã€ç¤¾å†…DBã€ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ç¢ºèªã®é †ã§æœ€é©ãªå›žç­”ã‚’æ§‹ç¯‰ã™ã‚‹é«˜ä¿¡é ¼æ€§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
  icon: ðŸ”
  icon_background: "#4A90E2"
  mode: advanced-chat
  name: æ®µéšŽçš„ç¢ºèªåž‹å•ã„åˆã‚ã›å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ 
  use_icon_as_answer_icon: false

kind: app
version: 0.3.0

workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
        - .PDF
        - .DOCX
        - .TXT
        - .CSV
      allowed_file_types:
        - document
      allowed_file_upload_methods:
        - local_file
      enabled: true
      number_limits: 3
    opening_statement: |
      æ®µéšŽçš„ç¢ºèªåž‹å•ã„åˆã‚ã›å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ ã¸ã‚ˆã†ã“ãã€‚
      
      ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãŠå®¢æ§˜ã‹ã‚‰ã®å•ã„åˆã‚ã›ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã®é †åºã§ç¢ºèªã‚’è¡Œã„ã€
      æœ€ã‚‚ç¢ºå®Ÿã§é©åˆ‡ãªå›žç­”ã‚’æä¾›ã—ã¾ã™ï¼š
      
      1. ç¤¾å†…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª
      2. ãƒ™ãƒ†ãƒ©ãƒ³ç¤¾å“¡ã®çŸ¥è¦‹ç¢ºèª
      3. ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ã®ç¢ºèªï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
      
      å•ã„åˆã‚ã›å†…å®¹ã¨ã€ãŠå®¢æ§˜ã®é€£çµ¡æ–¹æ³•ï¼ˆé›»è©±/FAXï¼‰ã‚’ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions:
      - åœ¨åº«çŠ¶æ³ã‚’ç¢ºèªã—ãŸã„ï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼åï¼šâ—¯â—¯ã€å•†å“åï¼šâ—¯â—¯ï¼‰
      - ä»£æ›¿å•†å“ã®ææ¡ˆã‚’å¸Œæœ›ï¼ˆç”¨é€”ï¼šâ—¯â—¯ã€äºˆç®—ï¼šâ—¯â—¯å††ï¼‰
      - ç´æœŸã®ç¢ºèªï¼ˆæ³¨æ–‡ç•ªå·ï¼šâ—¯â—¯ã€å•†å“åï¼šâ—¯â—¯ï¼‰
      - æŠ€è¡“çš„ãªä»•æ§˜ã«ã¤ã„ã¦è³ªå•ï¼ˆè£½å“åž‹ç•ªï¼šâ—¯â—¯ã€ç¢ºèªäº‹é …ï¼šâ—¯â—¯ï¼‰
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ja-JP
      voice: ja-JP-NaokiNeural

  graph:
    edges:
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: start-classification-edge
        source: start_node
        sourceHandle: source
        target: inquiry_classification_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: classification-db_check-edge
        source: inquiry_classification_node
        sourceHandle: source
        target: db_check_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: db_check-first_judgment
        source: db_check_node
        sourceHandle: source
        target: first_judgment_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: true
        id: first_judgment-response-edge
        source: first_judgment_node
        sourceHandle: true
        target: response_generation_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: false
        id: first_judgment-veteran-edge
        source: first_judgment_node
        sourceHandle: false
        target: veteran_check_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: veteran-second_judgment-edge
        source: veteran_check_node
        sourceHandle: source
        target: second_judgment_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: true
        id: second_judgment-response-edge
        source: second_judgment_node
        sourceHandle: true
        target: response_generation_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: false
        id: second_judgment-manufacturer-edge
        source: second_judgment_node
        sourceHandle: false
        target: manufacturer_prep_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: manufacturer-interim-edge
        source: manufacturer_prep_node
        sourceHandle: source
        target: interim_response_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: interim-status-edge
        source: interim_response_node
        sourceHandle: source
        target: status_management_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: status-final-edge
        source: status_management_node
        sourceHandle: source
        target: final_answer_node
        targetHandle: target
        type: custom
      - data:
          isInIteration: false
          targetHandle: target
          sourceHandle: source
        id: response-status-edge
        source: response_generation_node
        sourceHandle: source
        target: status_management_node
        targetHandle: target
        type: custom

    nodes:
      - data:
          title: å•ã„åˆã‚ã›å—ä»˜
          type: start
          variables:
            - label: å•ã„åˆã‚ã›å†…å®¹
              max_length: 2000
              required: true
              type: paragraph
              variable: inquiry_content
            - label: é€£çµ¡æ–¹æ³•
              options:
                - TEL
                - FAX
              required: true
              type: select
              variable: contact_method
            - label: ãŠå®¢æ§˜æƒ…å ±ï¼ˆä»»æ„ï¼‰
              max_length: 500
              required: false
              type: text-input
              variable: customer_info
        height: 157
        id: start_node
        position:
          x: 50
          y: 250
        type: start
        width: 244

      - data:
          context:
            enabled: true
            variable_selector:
              - start_node
              - inquiry_content
          desc: ã‚µãƒ³ãƒ—ãƒ«ã®7ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ãåˆ†é¡žã¨æƒ…å ±æŠ½å‡º
          memory:
            role_prefix:
              assistant: AI
              user: ãƒ¦ãƒ¼ã‚¶ãƒ¼
          model:
            completion_params:
              max_tokens: 1000
              temperature: 0.3
            mode: chat
            name: gpt-4o-mini
            provider: openai
          prompt_template:
            - role: system
              text: |
                ã‚ãªãŸã¯å•ã„åˆã‚ã›åˆ†é¡žã®å°‚é–€å®¶ã§ã™ã€‚ä»¥ä¸‹ã®å•ã„åˆã‚ã›ãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ã„ã¦åˆ†é¡žã¨æƒ…å ±æŠ½å‡ºã‚’è¡Œã£ã¦ãã ã•ã„ã€‚

                ã€å•ã„åˆã‚ã›ãƒ‘ã‚¿ãƒ¼ãƒ³ã€‘
                1. åœ¨åº«ç¢ºèªï¼ˆãƒ¡ãƒ¼ã‚«ãƒ¼åã€å•†å“åã€æ•°é‡ï¼‰
                2. ä»£æ›¿å•†å“ææ¡ˆï¼ˆç”¨é€”ã€äºˆç®—ã€å¸Œæœ›ä»•æ§˜ï¼‰
                3. ç´æœŸç¢ºèªï¼ˆæ³¨æ–‡ç•ªå·ã€å•†å“æƒ…å ±ï¼‰
                4. ä¾¡æ ¼å•ã„åˆã‚ã›ï¼ˆå•†å“åã€æ•°é‡ã€è¦‹ç©æ¡ä»¶ï¼‰
                5. æŠ€è¡“ä»•æ§˜ç¢ºèªï¼ˆè£½å“åž‹ç•ªã€ç¢ºèªé …ç›®ï¼‰
                6. ä¸å…·åˆãƒ»ã‚¯ãƒ¬ãƒ¼ãƒ ï¼ˆç—‡çŠ¶ã€ä½¿ç”¨çŠ¶æ³ï¼‰
                7. ãã®ä»–ä¸€èˆ¬å•ã„åˆã‚ã›

                ã€æŠ½å‡ºé …ç›®ã€‘
                - inquiry_type: å•ã„åˆã‚ã›ã‚¿ã‚¤ãƒ—ï¼ˆ1-7ã®ç•ªå·ï¼‰
                - manufacturer: ãƒ¡ãƒ¼ã‚«ãƒ¼å
                - product_category: å•†å“ã‚«ãƒ†ã‚´ãƒª
                - specific_items: å…·ä½“çš„ãªç¢ºèªäº‹é …
                - urgency_level: ç·Šæ€¥åº¦ï¼ˆhigh/medium/lowï¼‰
                - required_checks: å¿…è¦ãªç¢ºèªäº‹é …ãƒªã‚¹ãƒˆ

                JSONå½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
            - role: user
              text: "{{#start_node.inquiry_content#}}"
          selected: false
          title: å•ã„åˆã‚ã›åˆ†é¡ž
          type: llm
        height: 98
        id: inquiry_classification_node
        position:
          x: 350
          y: 250
        type: llm
        width: 244

      - data:
          code: |
            import json
            import datetime

            # åˆ†é¡žçµæžœã®è§£æž
            try:
                classification = json.loads(inquiry_classification)
            except:
                classification = {
                    "inquiry_type": "7",
                    "urgency_level": "medium",
                    "required_checks": ["general_check"]
                }

            # æ¨¡æ“¬çš„ãªç¤¾å†…DBç¢ºèª
            db_results = {
                "stock_info": {},
                "product_info": {},
                "past_inquiries": [],
                "internal_knowledge": {}
            }

            # å•ã„åˆã‚ã›ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸç¢ºèª
            if classification.get("inquiry_type") == "1":  # åœ¨åº«ç¢ºèª
                db_results["stock_info"] = {
                    "status": "checking",
                    "warehouse_A": "ç¢ºèªä¸­",
                    "warehouse_B": "ç¢ºèªä¸­",
                    "last_update": datetime.datetime.now().isoformat()
                }
            elif classification.get("inquiry_type") == "2":  # ä»£æ›¿å•†å“
                db_results["product_info"] = {
                    "alternatives": ["å•†å“A", "å•†å“B", "å•†å“C"],
                    "comparison": "è©³ç´°æ¯”è¼ƒãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­"
                }
            
            # éŽåŽ»ã®é¡žä¼¼å•ã„åˆã‚ã›æ¤œç´¢
            db_results["past_inquiries"] = [
                {
                    "date": "2024-12-01",
                    "summary": "é¡žä¼¼ã‚±ãƒ¼ã‚¹ã‚ã‚Š",
                    "resolution": "ãƒ™ãƒ†ãƒ©ãƒ³ç¢ºèªå¾Œå¯¾å¿œ"
                }
            ]

            # ç¤¾å†…ã§å›žç­”å¯èƒ½ã‹ã®åˆ¤å®š
            can_answer_internally = False
            confidence_score = 0.5

            # åŸºæœ¬çš„ãªåœ¨åº«æƒ…å ±ãŒã‚ã‚Œã°éƒ¨åˆ†çš„ã«å›žç­”å¯èƒ½
            if db_results["stock_info"] or db_results["product_info"]:
                confidence_score = 0.7
                if len(db_results["past_inquiries"]) > 0:
                    confidence_score = 0.8

            result = {
                "db_check_results": db_results,
                "can_answer_internally": confidence_score > 0.85,
                "confidence_score": confidence_score,
                "next_action": "veteran_check" if confidence_score < 0.85 else "generate_response"
            }

            return result
          code_language: python3
          desc: ç¤¾å†…ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèªå‡¦ç†
          outputs:
            db_check_results:
              type: object
            can_answer_internally:
              type: boolean
            confidence_score:
              type: number
            next_action:
              type: string
          selected: false
          title: ç¤¾å†…DBç¢ºèª
          type: code
          variables:
            - value_selector:
                - inquiry_classification_node
                - text
              variable: inquiry_classification
        height: 98
        id: db_check_node
        position:
          x: 650
          y: 250
        type: code
        width: 244

      - data:
          cases:
            - case_id: can_answer
              conditions:
                - comparison_operator: "="
                  value: true
                  variable_selector:
                    - db_check_node
                    - can_answer_internally
              logical_operator: and
          default_case_id: need_more_info
          desc: ç¤¾å†…æƒ…å ±ã§å›žç­”å¯èƒ½ã‹åˆ¤å®š
          title: ç¬¬1æ¬¡åˆ¤å®š
          type: if-else
        height: 98
        id: first_judgment_node
        position:
          x: 950
          y: 250
        type: if-else
        width: 244

      - data:
          context:
            enabled: true
            variable_selector:
              - start_node
              - inquiry_content
          desc: ãƒ™ãƒ†ãƒ©ãƒ³ç¤¾å“¡ã®çŸ¥è¦‹ã‚’æ´»ç”¨
          memory:
            role_prefix:
              assistant: AI
              user: ãƒ¦ãƒ¼ã‚¶ãƒ¼
          model:
            completion_params:
              max_tokens: 1500
              temperature: 0.4
            mode: chat
            name: gpt-4o-mini
            provider: openai
          prompt_template:
            - role: system
              text: |
                ã‚ãªãŸã¯ãƒ™ãƒ†ãƒ©ãƒ³ç¤¾å“¡ã®çŸ¥è­˜ã¨çµŒé¨“ã‚’æŒã¤ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã§ã™ã€‚
                
                ä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰å•ã„åˆã‚ã›ã«å¯¾ã™ã‚‹çŸ¥è¦‹ã‚’æä¾›ã—ã¦ãã ã•ã„ï¼š
                1. éŽåŽ»ã®é¡žä¼¼ã‚±ãƒ¼ã‚¹ã¨å¯¾å¿œæ–¹æ³•
                2. ç‰¹æ®Šãªæ¡ä»¶ã‚„æ³¨æ„äº‹é …
                3. ä»£æ›¿æ¡ˆã‚„ææ¡ˆäº‹é …
                4. ãƒ¡ãƒ¼ã‚«ãƒ¼ç¢ºèªãŒå¿…è¦ãªé …ç›®
                
                ç¤¾å†…DBã®çµæžœ: {{#db_check_node.db_check_results#}}
                
                å›žç­”å½¢å¼ï¼š
                - veteran_insights: ãƒ™ãƒ†ãƒ©ãƒ³ã®çŸ¥è¦‹
                - special_considerations: ç‰¹åˆ¥ãªé…æ…®äº‹é …
                - alternative_proposals: ä»£æ›¿ææ¡ˆ
                - manufacturer_check_items: ãƒ¡ãƒ¼ã‚«ãƒ¼ç¢ºèªå¿…è¦é …ç›®
                - can_answer_with_veteran: ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹ã§å›žç­”å¯èƒ½ã‹ï¼ˆtrue/falseï¼‰
                - confidence_level: ç¢ºä¿¡åº¦ï¼ˆ0-1ï¼‰
            - role: user
              text: "å•ã„åˆã‚ã›å†…å®¹ï¼š{{#start_node.inquiry_content#}}"
          selected: false
          title: ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹æ´»ç”¨
          type: llm
        height: 98
        id: veteran_check_node
        position:
          x: 950
          y: 450
        type: llm
        width: 244

      - data:
          cases:
            - case_id: can_answer_veteran
              conditions:
                - comparison_operator: contains
                  value: '"can_answer_with_veteran": true'
                  variable_selector:
                    - veteran_check_node
                    - text
              logical_operator: and
          default_case_id: need_manufacturer
          desc: ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹ã§å›žç­”å¯èƒ½ã‹åˆ¤å®š
          title: ç¬¬2æ¬¡åˆ¤å®š
          type: if-else
        height: 98
        id: second_judgment_node
        position:
          x: 1250
          y: 450
        type: if-else
        width: 244

      - data:
          context:
            enabled: true
            variable_selector:
              - start_node
              - inquiry_content
          desc: ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ã®ç¢ºèªäº‹é …ã‚’æ•´ç†
          memory:
            role_prefix:
              assistant: AI
              user: ãƒ¦ãƒ¼ã‚¶ãƒ¼
          model:
            completion_params:
              max_tokens: 1000
              temperature: 0.3
            mode: chat
            name: gpt-4o-mini
            provider: openai
          prompt_template:
            - role: system
              text: |
                ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ã®å•ã„åˆã‚ã›æº–å‚™ã‚’è¡Œã„ã¾ã™ã€‚
                
                ç¤¾å†…DBçµæžœ: {{#db_check_node.db_check_results#}}
                ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹: {{#veteran_check_node.text#}}
                
                ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
                
                ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ç¢ºèªäº‹é …ã€‘
                1. å„ªå…ˆåº¦ï¼šé«˜
                   - ç¢ºèªé …ç›®ï¼š
                   - ç†ç”±ï¼š
                
                2. å„ªå…ˆåº¦ï¼šä¸­
                   - ç¢ºèªé …ç›®ï¼š
                   - ç†ç”±ï¼š
                
                ã€å•ã„åˆã‚ã›æ–‡æ¡ˆã€‘
                ä»¶åï¼š
                æœ¬æ–‡ï¼š
                
                ã€å¿…è¦æƒ…å ±ã€‘
                - åž‹ç•ªï¼š
                - ãƒ­ãƒƒãƒˆç•ªå·ï¼š
                - ãã®ä»–ï¼š
            - role: user
              text: "å…ƒã®å•ã„åˆã‚ã›ï¼š{{#start_node.inquiry_content#}}"
          selected: false
          title: ãƒ¡ãƒ¼ã‚«ãƒ¼å•ã„åˆã‚ã›æº–å‚™
          type: llm
        height: 98
        id: manufacturer_prep_node
        position:
          x: 1250
          y: 650
        type: llm
        width: 244

      - data:
          context:
            enabled: true
            variable_selector:
              - start_node
              - inquiry_content
          desc: ç¢ºèªä¸­ã®æš«å®šå›žç­”ã‚’ç”Ÿæˆ
          memory:
            role_prefix:
              assistant: AI
              user: ãƒ¦ãƒ¼ã‚¶ãƒ¼
          model:
            completion_params:
              max_tokens: 1500
              temperature: 0.5
            mode: chat
            name: gpt-4o-mini
            provider: openai
          prompt_template:
            - role: system
              text: |
                ç¾åœ¨ã®ç¢ºèªçŠ¶æ³ã‚’è¸ã¾ãˆãŸæš«å®šå›žç­”ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                
                é€£çµ¡æ–¹æ³•ï¼š{{#start_node.contact_method#}}
                
                ã€å«ã‚ã‚‹ã¹ãå†…å®¹ã€‘
                1. ç¾åœ¨ç¢ºèªã§ãã¦ã„ã‚‹äº‹é …
                2. ç¢ºèªä¸­ã®äº‹é …ã¨äºˆæƒ³æ™‚é–“
                3. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                4. ãŠå®¢æ§˜ã¸ã®é…æ…®
                
                ç¤¾å†…DBçµæžœï¼š{{#db_check_node.db_check_results#}}
                ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹ï¼š{{#veteran_check_node.text#}}
                ãƒ¡ãƒ¼ã‚«ãƒ¼ç¢ºèªäº‹é …ï¼š{{#manufacturer_prep_node.text#}}
                
                ä¸å¯§ã§åˆ†ã‹ã‚Šã‚„ã™ã„æ—¥æœ¬èªžã§å›žç­”ã—ã¦ãã ã•ã„ã€‚
            - role: user
              text: "ãŠå®¢æ§˜ã®å•ã„åˆã‚ã›ï¼š{{#start_node.inquiry_content#}}"
          selected: false
          title: æš«å®šå›žç­”ç”Ÿæˆ
          type: llm
        height: 98
        id: interim_response_node
        position:
          x: 1550
          y: 650
        type: llm
        width: 244

      - data:
          context:
            enabled: true
            variable_selector:
              - start_node
              - inquiry_content
          desc: åŽé›†ã—ãŸæƒ…å ±ã‚’çµ±åˆã—ã¦æœ€é©ãªå›žç­”ã‚’ç”Ÿæˆ
          memory:
            role_prefix:
              assistant: AI
              user: ãƒ¦ãƒ¼ã‚¶ãƒ¼
          model:
            completion_params:
              max_tokens: 2000
              temperature: 0.4
            mode: chat
            name: gpt-4o-mini
            provider: openai
          prompt_template:
            - role: system
              text: |
                åŽé›†ã—ãŸå…¨ã¦ã®æƒ…å ±ã‚’åŸºã«ã€ãŠå®¢æ§˜ã¸ã®æœ€é©ãªå›žç­”ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚
                
                é€£çµ¡æ–¹æ³•ï¼š{{#start_node.contact_method#}}
                ãŠå®¢æ§˜æƒ…å ±ï¼š{{#start_node.customer_info#}}
                
                åˆ©ç”¨å¯èƒ½ãªæƒ…å ±ï¼š
                - ç¤¾å†…DBçµæžœï¼š{{#db_check_node.db_check_results#}}
                - ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹ï¼š{{#veteran_check_node.text#}}
                
                ã€å›žç­”ã®ãƒã‚¤ãƒ³ãƒˆã€‘
                1. æ˜Žç¢ºã§å…·ä½“çš„ãªæƒ…å ±æä¾›
                2. æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã®æ˜Žç¤º
                3. å•ã„åˆã‚ã›ã¸ã®æ„Ÿè¬
                4. è¿½åŠ è³ªå•ã¸ã®å¯¾å¿œæº–å‚™
                
                ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã§æ¸©ã‹ã¿ã®ã‚ã‚‹å¯¾å¿œã‚’å¿ƒãŒã‘ã¦ãã ã•ã„ã€‚
            - role: user
              text: "ãŠå®¢æ§˜ã®å•ã„åˆã‚ã›ï¼š{{#start_node.inquiry_content#}}"
          selected: false
          title: çµ±åˆå›žç­”ç”Ÿæˆ
          type: llm
        height: 98
        id: response_generation_node
        position:
          x: 1550
          y: 250
        type: llm
        width: 244

      - data:
          code: |
            import json
            import datetime

            # å„ç¢ºèªæ®µéšŽã®çŠ¶æ…‹ã‚’è¨˜éŒ²
            status_record = {
                "inquiry_id": f"INQ_{datetime.datetime.now().strftime('%Y%m%d%H%M%S')}",
                "timestamp": datetime.datetime.now().isoformat(),
                "contact_method": contact_method,
                "customer_info": customer_info or "æœªç™»éŒ²",
                "inquiry_content": inquiry_content,
                "process_stages": {
                    "db_check": {
                        "completed": True,
                        "confidence": db_confidence,
                        "result_summary": "ç¤¾å†…DBç¢ºèªå®Œäº†"
                    },
                    "veteran_check": {
                        "completed": veteran_text is not None,
                        "result_summary": "ãƒ™ãƒ†ãƒ©ãƒ³çŸ¥è¦‹ç¢ºèª" if veteran_text else "æœªå®Ÿæ–½"
                    },
                    "manufacturer_check": {
                        "completed": manufacturer_text is not None,
                        "status": "æº–å‚™å®Œäº†" if manufacturer_text else "ä¸è¦",
                        "follow_up_required": manufacturer_text is not None
                    }
                },
                "response_provided": True,
                "follow_up_tasks": []
            }

            # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã‚¿ã‚¹ã‚¯ã®ç”Ÿæˆ
            if manufacturer_text:
                status_record["follow_up_tasks"].append({
                    "task": "ãƒ¡ãƒ¼ã‚«ãƒ¼ã¸ã®ç¢ºèªå®Ÿæ–½",
                    "priority": "high",
                    "due_date": datetime.datetime.now() + datetime.timedelta(days=1)
                })

            # ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¤å®š
            escalation_required = False
            if "urgent" in inquiry_content.lower() or "è‡³æ€¥" in inquiry_content:
                escalation_required = True
                status_record["escalation"] = {
                    "required": True,
                    "reason": "ç·Šæ€¥æ¡ˆä»¶",
                    "notified_to": "ä¸Šç´šç®¡ç†è€…"
                }

            return {
                "status_record": status_record,
                "escalation_required": escalation_required,
                "process_summary": f"å•ã„åˆã‚ã›ID: {status_record['inquiry_id']} - å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¨˜éŒ²å®Œäº†"
            }
          code_language: python3
          desc: ç¢ºèªãƒ—ãƒ­ã‚»ã‚¹ã®çŠ¶æ…‹ç®¡ç†ã¨ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
          outputs:
            status_record:
              type: object
            escalation_required:
              type: boolean
            process_summary:
              type: string
          selected: false
          title: ç¢ºèªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
          type: code
          variables:
            - value_selector:
                - start_node
                - inquiry_content
              variable: inquiry_content
            - value_selector:
                - start_node
                - contact_method
              variable: contact_method
            - value_selector:
                - start_node
                - customer_info
              variable: customer_info
            - value_selector:
                - db_check_node
                - confidence_score
              variable: db_confidence
            - value_selector:
                - veteran_check_node
                - text
              variable: veteran_text
            - value_selector:
                - manufacturer_prep_node
                - text
              variable: manufacturer_text
        height: 98
        id: status_management_node
        position:
          x: 1850
          y: 450
        type: code
        width: 244

      - data:
          answer:
            "{{#response_generation_node.text#}}\n\n{{#interim_response_node.text#}}\n\n
            ---\nã€å‡¦ç†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€‘\n{{#status_management_node.process_summary#}}"
          desc: æœ€çµ‚çš„ãªå›žç­”ã‚’ãŠå®¢æ§˜ã«æä¾›
          selected: false
          title: æœ€çµ‚å›žç­”
          type: answer
        height: 98
        id: final_answer_node
        position:
          x: 2150
          y: 450
        type: answer
        width: 244

  hash: f5e7d3a2b1c4