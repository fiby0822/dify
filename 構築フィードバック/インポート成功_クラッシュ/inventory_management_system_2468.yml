app:
  description: "å•†å“åœ¨åº«ç®¡ç†ã¨è‡ªå‹•ç™ºæ³¨ææ¡ˆã‚’è¡Œã†AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã€‚åœ¨åº«ãƒ¬ãƒ™ãƒ«ã€å•†å“é‡è¦åº¦ã€è²©å£²å‚¾å‘ã‚’ç·åˆçš„ã«åˆ†æã—ã€é©åˆ‡ãªç™ºæ³¨ææ¡ˆã‚’è¡Œã„ã¾ã™ã€‚"
  icon: "ğŸ“¦"
  icon_background: "#E3F2FD"
  mode: advanced-chat
  name: "åœ¨åº«ç®¡ç†ç™ºæ³¨ææ¡ˆã‚·ã‚¹ãƒ†ãƒ "
  use_icon_as_answer_icon: false

dependencies: []

kind: app

version: 0.3.0

workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: |
      åœ¨åº«ç®¡ç†ç™ºæ³¨ææ¡ˆã‚·ã‚¹ãƒ†ãƒ ã¸ã‚ˆã†ã“ãï¼
      
      å•†å“ã®åœ¨åº«æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ã„ãŸã ã‘ã‚Œã°ã€é©åˆ‡ãªç™ºæ³¨ææ¡ˆã‚’ã„ãŸã—ã¾ã™ã€‚
      
      ä»¥ä¸‹ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š
      å•†å“åï¼šã€‡ã€‡
      ç¾åœ¨åº«æ•°ï¼šã€‡ã€‡
      é‡è¦åº¦ï¼šé«˜/ä¸­/ä½
      å‰æœˆè²©å£²æ•°ï¼šã€‡ã€‡
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions:
      - "å•†å“åï¼šãƒãƒ¼ãƒˆPCã€€ç¾åœ¨åº«æ•°ï¼š8ã€€é‡è¦åº¦ï¼šé«˜ã€€å‰æœˆè²©å£²æ•°ï¼š25"
      - "å•†å“åï¼šãƒã‚¦ã‚¹ã€€ç¾åœ¨åº«æ•°ï¼š150ã€€é‡è¦åº¦ï¼šä½ã€€å‰æœˆè²©å£²æ•°ï¼š30"
      - "å•†å“åï¼šã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€€ç¾åœ¨åº«æ•°ï¼š35ã€€é‡è¦åº¦ï¼šä¸­ã€€å‰æœˆè²©å£²æ•°ï¼š40"
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
      - data:
          isInLoop: false
          sourceType: start
          targetType: code
        id: start-parse-edge
        selected: false
        source: start_node
        sourceHandle: source
        target: parse_input_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: code
          targetType: if-else
        id: parse-null-edge
        selected: false
        source: parse_input_node
        sourceHandle: source
        target: null_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: answer
        id: null-error-edge
        selected: false
        source: null_check_node
        sourceHandle: empty_product_case
        target: error_answer_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: if-else
        id: null-stock-edge
        selected: false
        source: null_check_node
        sourceHandle: false
        target: stock_level_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: if-else
        id: stock-urgent-edge
        selected: false
        source: stock_level_check_node
        sourceHandle: urgent_case
        target: importance_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: if-else
        id: stock-warning-edge
        selected: false
        source: stock_level_check_node
        sourceHandle: warning_case
        target: importance_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: if-else
        id: stock-normal-edge
        selected: false
        source: stock_level_check_node
        sourceHandle: normal_case
        target: importance_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: if-else
        id: stock-excess-edge
        selected: false
        source: stock_level_check_node
        sourceHandle: excess_case
        target: importance_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: if-else
        id: importance-sales-edge
        selected: false
        source: importance_check_node
        sourceHandle: false
        target: sales_trend_check_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: if-else
          targetType: llm
        id: sales-report-edge
        selected: false
        source: sales_trend_check_node
        sourceHandle: false
        target: generate_report_node
        targetHandle: target
        type: custom
        zIndex: 0
      - data:
          isInLoop: false
          sourceType: llm
          targetType: answer
        id: report-answer-edge
        selected: false
        source: generate_report_node
        sourceHandle: source
        target: final_answer_node
        targetHandle: target
        type: custom
        zIndex: 0
    nodes:
      - data:
          desc: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å—ã‘å–ã‚Š"
          selected: false
          title: "é–‹å§‹"
          type: start
          variables: []
        height: 54
        id: start_node
        position:
          x: 50
          y: 400
        positionAbsolute:
          x: 50
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          code: |
            import re
            
            user_input = sys.query
            
            product_name = ""
            stock_count = 0
            importance = ""
            last_month_sales = 0
            
            product_match = re.search(r'å•†å“å[ï¼š:]\s*(.+?)(?:\s|ã€€|$)', user_input)
            if product_match:
                product_name = product_match.group(1).strip()
            
            stock_match = re.search(r'ç¾åœ¨åº«æ•°[ï¼š:]\s*(\d+)', user_input)
            if stock_match:
                stock_count = int(stock_match.group(1))
            
            importance_match = re.search(r'é‡è¦åº¦[ï¼š:]\s*(é«˜|ä¸­|ä½)', user_input)
            if importance_match:
                importance = importance_match.group(1)
            
            sales_match = re.search(r'å‰æœˆè²©å£²æ•°[ï¼š:]\s*(\d+)', user_input)
            if sales_match:
                last_month_sales = int(sales_match.group(1))
            
            sales_ratio = 0
            if last_month_sales > 0:
                sales_ratio = (stock_count / last_month_sales) * 100
            
            result = {
                "product_name": product_name,
                "stock_count": stock_count,
                "importance": importance,
                "last_month_sales": last_month_sales,
                "sales_ratio": sales_ratio,
                "original_input": user_input
            }
          code_language: python3
          desc: "å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®è§£æã¨å¤‰æ•°æŠ½å‡º"
          outputs:
            product_name:
              type: string
            stock_count:
              type: number
            importance:
              type: string
            last_month_sales:
              type: number
            sales_ratio:
              type: number
            original_input:
              type: string
          selected: false
          title: "å…¥åŠ›è§£æ"
          type: code
          variables:
            - value_selector:
                - sys
                - query
              variable: sys.query
        height: 54
        id: parse_input_node
        position:
          x: 350
          y: 400
        positionAbsolute:
          x: 350
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          type: if-else
          cases:
            - id: empty_product_case
              case_id: empty_product_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - product_name
                  comparison_operator: empty
                  value: ""
              logical_operator: and
          desc: "å¿…é ˆé …ç›®ã®å­˜åœ¨ç¢ºèª"
          selected: false
          title: "NULL/å­˜åœ¨ãƒã‚§ãƒƒã‚¯"
        height: 154
        id: null_check_node
        position:
          x: 650
          y: 400
        positionAbsolute:
          x: 650
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          answer: |
            ã‚¨ãƒ©ãƒ¼ï¼šå•†å“åãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚
            
            ä»¥ä¸‹ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š
            å•†å“åï¼šã€‡ã€‡
            ç¾åœ¨åº«æ•°ï¼šã€‡ã€‡
            é‡è¦åº¦ï¼šé«˜/ä¸­/ä½
            å‰æœˆè²©å£²æ•°ï¼šã€‡ã€‡
          desc: "ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
          selected: false
          title: "ã‚¨ãƒ©ãƒ¼å‡ºåŠ›"
          type: answer
          variables: []
        height: 107
        id: error_answer_node
        position:
          x: 950
          y: 250
        positionAbsolute:
          x: 950
          y: 250
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          type: if-else
          cases:
            - id: urgent_case
              case_id: urgent_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - stock_count
                  comparison_operator: "â‰¤"
                  value: 10
              logical_operator: and
            - id: warning_case
              case_id: warning_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - stock_count
                  comparison_operator: "â‰¤"
                  value: 50
              logical_operator: and
            - id: normal_case
              case_id: normal_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - stock_count
                  comparison_operator: "â‰¤"
                  value: 100
              logical_operator: and
            - id: excess_case
              case_id: excess_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - stock_count
                  comparison_operator: ">"
                  value: 100
              logical_operator: and
          desc: "åœ¨åº«æ•°ã«ã‚ˆã‚‹åˆ†é¡"
          selected: false
          title: "åœ¨åº«ãƒ¬ãƒ™ãƒ«åˆ¤å®š"
        height: 198
        id: stock_level_check_node
        position:
          x: 950
          y: 400
        positionAbsolute:
          x: 950
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          type: if-else
          cases:
            - id: high_urgent_case
              case_id: high_urgent_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - importance
                  comparison_operator: is
                  value: "é«˜"
                - variable_selector:
                    - parse_input_node
                    - stock_count
                  comparison_operator: "â‰¤"
                  value: 10
              logical_operator: and
            - id: high_warning_case
              case_id: high_warning_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - importance
                  comparison_operator: is
                  value: "é«˜"
                - variable_selector:
                    - parse_input_node
                    - stock_count
                  comparison_operator: "â‰¤"
                  value: 50
              logical_operator: and
          desc: "é‡è¦åº¦ã¨åœ¨åº«ãƒ¬ãƒ™ãƒ«ã®è¤‡åˆåˆ¤å®š"
          selected: false
          title: "è¤‡åˆæ¡ä»¶åˆ¤å®š"
        height: 154
        id: importance_check_node
        position:
          x: 1250
          y: 400
        positionAbsolute:
          x: 1250
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          type: if-else
          cases:
            - id: shortage_trend_case
              case_id: shortage_trend_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - sales_ratio
                  comparison_operator: "<"
                  value: 50
              logical_operator: and
            - id: excess_trend_case
              case_id: excess_trend_case
              conditions:
                - variable_selector:
                    - parse_input_node
                    - sales_ratio
                  comparison_operator: "â‰¥"
                  value: 200
              logical_operator: and
          desc: "è²©å£²å‚¾å‘ã®åˆ†æ"
          selected: false
          title: "è²©å£²å‚¾å‘ãƒã‚§ãƒƒã‚¯"
        height: 154
        id: sales_trend_check_node
        position:
          x: 1550
          y: 400
        positionAbsolute:
          x: 1550
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          model:
            provider: openai
            name: gpt-4o
            mode: chat
            completion_params:
              temperature: 0.7
              max_tokens: 1000
          prompt_template:
            - id: system-prompt
              role: system
              text: |
                ã‚ãªãŸã¯åœ¨åº«ç®¡ç†ã®å°‚é–€å®¶ã§ã™ã€‚
                å•†å“ã®åœ¨åº«çŠ¶æ³ã€é‡è¦åº¦ã€è²©å£²å‚¾å‘ã‚’ç·åˆçš„ã«åˆ†æã—ã€é©åˆ‡ãªç™ºæ³¨ææ¡ˆã‚’è¡Œã£ã¦ãã ã•ã„ã€‚
                
                ææ¡ˆã«ã¯ä»¥ä¸‹ã‚’å«ã‚ã¦ãã ã•ã„ï¼š
                1. ç¾çŠ¶åˆ†æï¼ˆåœ¨åº«ãƒ¬ãƒ™ãƒ«ã€è²©å£²å‚¾å‘ï¼‰
                2. æ¨å¥¨ç™ºæ³¨æ•°é‡ï¼ˆå…·ä½“çš„ãªæ•°å€¤ï¼‰
                3. ç™ºæ³¨å„ªå…ˆåº¦ï¼ˆæœ€å„ªå…ˆ/å„ªå…ˆ/é€šå¸¸/ä¸è¦ï¼‰
                4. ç†ç”±èª¬æ˜
                5. è¿½åŠ ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹
            - id: user-prompt
              role: user
              text: |
                å•†å“æƒ…å ±ï¼š
                - å•†å“åï¼š{{#parse_input_node.product_name#}}
                - ç¾åœ¨åº«æ•°ï¼š{{#parse_input_node.stock_count#}}å€‹
                - é‡è¦åº¦ï¼š{{#parse_input_node.importance#}}
                - å‰æœˆè²©å£²æ•°ï¼š{{#parse_input_node.last_month_sales#}}å€‹
                - åœ¨åº«/è²©å£²æ¯”ç‡ï¼š{{#parse_input_node.sales_ratio#}}%
                
                ã“ã®å•†å“ã®ç™ºæ³¨ææ¡ˆã‚’ã—ã¦ãã ã•ã„ã€‚
          structured_output_enabled: false
          vision:
            enabled: false
          context:
            enabled: false
            variable_selector: []
          memory:
            enabled: false
          selected: false
          title: "ç™ºæ³¨ææ¡ˆç”Ÿæˆ"
          type: llm
        height: 98
        id: generate_report_node
        position:
          x: 1850
          y: 400
        positionAbsolute:
          x: 1850
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
      - data:
          answer: |
            {{#generate_report_node.text#}}
            
            ---
            ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ä»–ã®å•†å“ã®åœ¨åº«åˆ†æã‚‚ãŠæ°—è»½ã«ã”ä¾é ¼ãã ã•ã„ã€‚
          desc: "æœ€çµ‚çµæœã®å‡ºåŠ›"
          selected: false
          title: "çµæœå‡ºåŠ›"
          type: answer
          variables: []
        height: 107
        id: final_answer_node
        position:
          x: 2150
          y: 400
        positionAbsolute:
          x: 2150
          y: 400
        selected: false
        sourcePosition: right
        targetPosition: left
        type: custom
        width: 244
    viewport:
      x: 0
      y: 0
      zoom: 0.5