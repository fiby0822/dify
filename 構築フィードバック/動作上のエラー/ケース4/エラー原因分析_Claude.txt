# ケース4: 営業成績評価システム_検証用.yml エラー原因分析

## エラー内容
- 3 validation errors for ToolNodeData
- tool_parameters.ranges: Input should be a valid dictionary or instance of ToolInput
- tool_parameters.renderOption: Input should be a valid dictionary or instance of ToolInput  
- tool_parameters.valueRenderOption: Input should be a valid dictionary or instance of ToolInput

## エラー発生箇所
ツールノード（ID: 1733389201002）のパラメータ設定：

```yaml
tool_parameters:
  ranges: "営業データ!A1:C10"
  renderOption: FORMATTED_VALUE
  valueRenderOption: FORMATTED_VALUE
```

## エラー原因
1. **ツールパラメータの型指定の誤り**：
   - tool_parametersには`type`と`value`を含む辞書形式が必要
   - 文字列を直接指定しているため、型エラーが発生

2. **正しいツールパラメータ形式の未使用**：
   - 他の成功例では以下の形式を使用：
   ```yaml
   tool_parameters:
     ranges:
       type: mixed
       value: '["営業データ!A1:C10"]'
   ```

3. **ツール名とプロバイダーIDの不一致**：
   - provider_id: `google`
   - tool_name: `google_sheets_read_spreadsheet`
   - 正しくは: provider_id: `omluc/google_sheets/google_sheets`、tool_name: `batch_get`

4. **Pydantic検証エラー**：
   - DifyのAPI設計では、tool_parametersの各値はToolInputオブジェクトとして検証される
   - 単純な文字列値の代わりに、type/value構造を持つオブジェクトが必要

## 成功例との比較
成功例では：
```yaml
tool_parameters:
  ranges:
    type: mixed
    value: '["INVENTORY!A1:C10"]'
  spreadsheet_id:
    type: mixed
    value: "1dd5IPZBYY5ZtImb48SLnO8c9b4Z8w5YUr1gWF0STqSQ"
```

## 修正案
```yaml
tool_parameters:
  ranges:
    type: mixed
    value: '["営業データ!A1:C10"]'
  spreadsheet_id:
    type: mixed
    value: "test_spreadsheet_id"
  renderOption:
    type: mixed
    value: "FORMATTED_VALUE"
  valueRenderOption:
    type: mixed
    value: "FORMATTED_VALUE"
```

また、provider_idとtool_nameも修正が必要：
- provider_id: `omluc/google_sheets/google_sheets`
- tool_name: `batch_get`

## 推奨事項
1. すべてのtool_parametersは`type`と`value`を含む構造体として定義
2. provider_idは完全なパス形式（`omluc/google_sheets/google_sheets`）を使用
3. 配列パラメータは文字列化されたJSON形式で提供