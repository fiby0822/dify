app:
  description: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦OCRãƒ»ç”»åƒèªè­˜ã‚’è¡Œã†ãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
  icon: ğŸ–¼ï¸
  icon_background: "#E0F2FE"
  mode: advanced-chat
  name: ç”»åƒèªè­˜OCRãƒ†ã‚¹ãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
  use_icon_as_answer_icon: false

dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.0.26@c1e643ac6a7732f6333a783320b4d3026fa5e31d8e7026375b98d44418d33f26

kind: app
version: 0.3.0

workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: true
      allowed_file_types:
        - image
        - document
      allowed_file_extensions:
        - .JPG
        - .JPEG
        - .PNG
        - .WEBP
        - .HEIC
        - .PDF
      fileUploadConfig:
        image_file_size_limit: 10
        file_size_limit: 15
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 5
        transfer_methods:
          - local_file
          - remote_url
    opening_statement: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚OCRãƒ»ç”»åƒèªè­˜ã‚’è¡Œã„ã¾ã™ã€‚
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: start
        targetType: llm
      id: start-vision-edge
      selected: false
      source: start_node
      sourceHandle: source
      target: image_recognition_llm
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: if-else
      id: vision-check-edge
      selected: false
      source: image_recognition_llm
      sourceHandle: source
      target: check_recognition_result
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: template-transform
      id: check-transform-edge
      selected: false
      source: check_recognition_result
      sourceHandle: true
      target: format_result_template
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: check-error-edge
      selected: false
      source: check_recognition_result
      sourceHandle: false
      target: answer_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: template-transform
        targetType: answer
      id: transform-answer-edge
      selected: false
      source: format_result_template
      sourceHandle: source
      target: answer_node
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: é–‹å§‹
        type: start
        variables: []
      height: 53
      id: start_node
      position:
        x: 50
        y: 282
      positionAbsolute:
        x: 50
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ç”»åƒã‚’åˆ†æã—ã¦OCRãƒ»ç”»åƒèªè­˜ã‚’å®Ÿè¡Œ
        model:
          completion_params: {}
          mode: chat
          name: gpt-4o
          provider: openai
        prompt_template:
        - id: system-prompt
          role: system
          text: |
            ç”»åƒã‚’è©³ç´°ã«åˆ†æã—ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ï¼š
            
            1. ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ï¼ˆOCRï¼‰
            - ç”»åƒå†…ã®ã™ã¹ã¦ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æ­£ç¢ºã«èª­ã¿å–ã‚‹
            - æ‰‹æ›¸ãæ–‡å­—ã‚‚å«ã‚ã¦æŠ½å‡º
            
            2. ç”»åƒã®å†…å®¹
            - å«ã¾ã‚Œã‚‹ç‰©ä½“ã‚„äººç‰©
            - å ´æ‰€ã‚„çŠ¶æ³
            
            3. è‰²å½©æƒ…å ±
            - ä¸»è¦ãªè‰²
            - é…è‰²ã®ç‰¹å¾´
            
            4. å…¨ä½“çš„ãªå°è±¡ã‚„ç”¨é€”
            
            æƒ…å ±ã¯æ§‹é€ åŒ–ã—ã¦å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
        - id: user-prompt
          role: user
          text: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚
        selected: false
        structured_output_enabled: false
        title: ç”»åƒèªè­˜ãƒ»OCRå‡¦ç†
        type: llm
        variables: []
        vision:
          configs:
            detail: high
            variable_selector: []
          enabled: true
      height: 150
      id: image_recognition_llm
      position:
        x: 350
        y: 282
      positionAbsolute:
        x: 350
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: not empty
            id: recognition-exists
            value: ''
            variable_selector:
            - image_recognition_llm
            - text
          logical_operator: and
        desc: ''
        logical_operator: and
        selected: false
        title: èªè­˜çµæœç¢ºèª
        type: if-else
      height: 125
      id: check_recognition_result
      position:
        x: 650
        y: 282
      positionAbsolute:
        x: 650
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: èªè­˜çµæœã‚’è¦‹ã‚„ã™ãæ•´å½¢
        selected: false
        template: |
          ## ç”»åƒèªè­˜ãƒ»OCRçµæœ
          
          {{ image_recognition_llm.text }}
          
          ---
          
          âœ… ç”»åƒã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚
        title: çµæœæ•´å½¢
        type: template-transform
        variables:
        - value_selector:
          - image_recognition_llm
          - text
          variable: image_recognition_llm.text
      height: 153
      id: format_result_template
      position:
        x: 950
        y: 202
      positionAbsolute:
        x: 950
        y: 202
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '{% if format_result_template.output %}{{#format_result_template.output#}}{% else %}ç”»åƒã®èªè­˜ãƒ»OCRå‡¦ç†ã«å¤±æ•—ã—ã¾ã—ãŸã€‚

          - å¯¾å¿œã—ã¦ã„ã‚‹ç”»åƒå½¢å¼ï¼šJPGã€JPEGã€PNGã€WEBPã€HEICã€PDF

          - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºä¸Šé™ï¼š10MBï¼ˆç”»åƒï¼‰ã€15MBï¼ˆPDFï¼‰

          å†åº¦æ­£ã—ã„ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚{% endif %}'
        desc: ''
        selected: false
        title: å›ç­”
        type: answer
        variables: []
      height: 161
      id: answer_node
      position:
        x: 1250
        y: 282
      positionAbsolute:
        x: 1250
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244