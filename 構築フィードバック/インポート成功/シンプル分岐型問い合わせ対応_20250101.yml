app:
  description: é¡§å®¢ã‹ã‚‰ã®å•ã„åˆã‚ã›ã‚’å•†å“ä»•æ§˜ãƒ»åœ¨åº«çŠ¶æ³ã«åˆ†é¡ã—ã€ãã‚Œãã‚Œã«å¿œã˜ãŸé¡§å®¢å‘ã‘ãƒ»ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘æ–‡ç« ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªåˆ†å²å‹ã‚¢ãƒ—ãƒª
  icon: ğŸ“§
  icon_background: '#4F46E5'
  mode: advanced-chat
  name: ã‚·ãƒ³ãƒ—ãƒ«åˆ†å²å‹å•ã„åˆã‚ã›å¯¾å¿œ
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.0.26@c1e643ac6a7732f6333a783320b4d3026fa5e31d8e7026375b98d44418d33f26
kind: app
version: 0.3.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      enabled: false
    opening_statement: 'ğŸ“§ ã‚·ãƒ³ãƒ—ãƒ«åˆ†å²å‹å•ã„åˆã‚ã›å¯¾å¿œã‚·ã‚¹ãƒ†ãƒ 

      é¡§å®¢ã‹ã‚‰ã®å•ã„åˆã‚ã›å†…å®¹ã‚’å…¥åŠ›ã™ã‚‹ã¨ã€ä»¥ä¸‹ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ï¼š
      âœ… å•ã„åˆã‚ã›ç¨®åˆ¥ã®è‡ªå‹•åˆ¤å®šï¼ˆå•†å“ä»•æ§˜/åœ¨åº«çŠ¶æ³ï¼‰
      ğŸ“ é¡§å®¢å‘ã‘ã®ä¸å¯§ãªè¿”ä¿¡æ–‡
      ğŸ­ ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ã®ç¢ºèªä¾é ¼æ–‡

      ã€å¯¾å¿œå¯èƒ½ãªå•ã„åˆã‚ã›ã€‘
      â€¢ å•†å“ä»•æ§˜ï¼šæ€§èƒ½ã€ã‚µã‚¤ã‚ºã€æ©Ÿèƒ½ã€ä½¿ã„æ–¹ãªã©
      â€¢ åœ¨åº«çŠ¶æ³ï¼šåœ¨åº«ç¢ºèªã€ç´æœŸã€å…¥è·äºˆå®šãªã©

      å•ã„åˆã‚ã›å†…å®¹ã¨å¿…è¦æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚'
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions:
    - ã“ã®å•†å“ã®è©³ã—ã„ä»•æ§˜ã‚’æ•™ãˆã¦ãã ã•ã„
    - åœ¨åº«çŠ¶æ³ã¨ç´æœŸã‚’ç¢ºèªã—ãŸã„ã§ã™
    - è£½å“ã®ä½¿ã„æ–¹ã«ã¤ã„ã¦è³ªå•ãŒã‚ã‚Šã¾ã™
    - å…¥è·äºˆå®šã¯ã„ã¤é ƒã«ãªã‚Šã¾ã™ã‹
    suggested_questions_after_answer:
      enabled: true
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: start
        targetType: if-else
      id: start-classification-edge
      selected: false
      source: start_node
      sourceHandle: source
      target: inquiry_classification_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: classification-spec-edge
      selected: false
      source: inquiry_classification_node
      sourceHandle: product_spec
      target: product_spec_response_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: classification-stock-edge
      selected: false
      source: inquiry_classification_node
      sourceHandle: stock_status
      target: stock_status_response_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: code
      id: spec-integration-edge
      selected: false
      source: product_spec_response_node
      sourceHandle: source
      target: response_integration_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: code
      id: stock-integration-edge
      selected: false
      source: stock_status_response_node
      sourceHandle: source
      target: response_integration_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: answer
      id: integration-answer-edge
      selected: false
      source: response_integration_node
      sourceHandle: source
      target: final_answer_node
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: é¡§å®¢ã‹ã‚‰ã®å•ã„åˆã‚ã›å†…å®¹ã¨é–¢é€£æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
        selected: false
        title: é–‹å§‹
        type: start
        variables:
        - label: å•ã„åˆã‚ã›å†…å®¹
          max_length: 1000
          options: []
          required: true
          type: paragraph
          variable: inquiry_content
        - label: é¡§å®¢å
          max_length: 100
          options: []
          required: true
          type: text-input
          variable: customer_name
        - label: å•†å“å
          max_length: 200
          options: []
          required: true
          type: text-input
          variable: product_name
        - label: å•†å“å‹ç•ª
          max_length: 100
          options: []
          required: false
          type: text-input
          variable: product_model
        - label: ãƒ¡ãƒ¼ã‚«ãƒ¼å
          max_length: 100
          options: []
          required: true
          type: text-input
          variable: manufacturer_name
      height: 270
      id: start_node
      position:
        x: 50
        y: 150
      positionAbsolute:
        x: 50
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: product_spec
          conditions:
          - comparison_operator: contains
            id: spec_keyword_check1
            value: ä»•æ§˜
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check2
            value: æ€§èƒ½
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check3
            value: ã‚µã‚¤ã‚º
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check4
            value: æ©Ÿèƒ½
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check5
            value: ä½¿ã„æ–¹
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check6
            value: ã‚¹ãƒšãƒƒã‚¯
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check7
            value: ç‰¹å¾´
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check8
            value: é‡é‡
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: spec_keyword_check9
            value: å¯¸æ³•
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          id: product_spec
          logical_operator: or
        - case_id: stock_status
          conditions:
          - comparison_operator: contains
            id: stock_keyword_check1
            value: åœ¨åº«
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check2
            value: ç´æœŸ
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check3
            value: å–ã‚Šå¯„ã›
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check4
            value: å…¥è·
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check5
            value: å“åˆ‡ã‚Œ
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check6
            value: ã„ã¤å±Š
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check7
            value: é…é€
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          - comparison_operator: contains
            id: stock_keyword_check8
            value: ç™ºé€
            varType: string
            variable_selector:
            - start_node
            - inquiry_content
          id: stock_status
          logical_operator: or
        desc: å•ã„åˆã‚ã›å†…å®¹ã‹ã‚‰ç¨®åˆ¥ã‚’åˆ¤å®š
        selected: false
        title: å•ã„åˆã‚ã›ç¨®åˆ¥åˆ¤å®š
        type: if-else
      height: 198
      id: inquiry_classification_node
      position:
        x: 350
        y: 150
      positionAbsolute:
        x: 350
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: å•†å“ä»•æ§˜ã«é–¢ã™ã‚‹é¡§å®¢ãƒ»ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘æ–‡ç« ç”Ÿæˆ
        model:
          completion_params:
            temperature: 0.3
          mode: chat
          name: gpt-4
          provider: langgenius/openai/openai
        prompt_template:
        - id: system-prompt
          role: system
          text: 'ã‚ãªãŸã¯ä¸å¯§ãªã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæ‹…å½“è€…ã§ã™ã€‚
            å•†å“ä»•æ§˜ã«é–¢ã™ã‚‹å•ã„åˆã‚ã›ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã®2ã¤ã®æ–‡ç« ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š

            1. é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡ï¼ˆä¸å¯§ã§åˆ†ã‹ã‚Šã‚„ã™ã„ï¼‰
            2. ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ç¢ºèªä¾é ¼æ–‡ï¼ˆå…·ä½“çš„ã§æŠ€è¡“çš„ï¼‰

            å¿…ãšä¸¡æ–¹ã®æ–‡ç« ã‚’ç”Ÿæˆã—ã€æ˜ç¢ºã«åŒºåˆ¥ã—ã¦ãã ã•ã„ã€‚'
        - id: user-prompt
          role: user
          text: 'ã€å•ã„åˆã‚ã›å†…å®¹ã€‘
            {{#start_node.inquiry_content#}}

            ã€é¡§å®¢æƒ…å ±ã€‘
            é¡§å®¢å: {{#start_node.customer_name#}}æ§˜

            ã€å•†å“æƒ…å ±ã€‘
            å•†å“å: {{#start_node.product_name#}}
            å‹ç•ª: {{#start_node.product_model#}}
            ãƒ¡ãƒ¼ã‚«ãƒ¼å: {{#start_node.manufacturer_name#}}

            ä¸Šè¨˜ã®å•ã„åˆã‚ã›ã«å¯¾ã—ã¦ã€é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡ã¨ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ç¢ºèªä¾é ¼æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        structured_output_enabled: false
        title: å•†å“ä»•æ§˜å¯¾å¿œæ–‡ç« ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 118
      id: product_spec_response_node
      position:
        x: 650
        y: 50
      positionAbsolute:
        x: 650
        y: 50
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: åœ¨åº«çŠ¶æ³ã«é–¢ã™ã‚‹é¡§å®¢ãƒ»ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘æ–‡ç« ç”Ÿæˆ
        model:
          completion_params:
            temperature: 0.3
          mode: chat
          name: gpt-4
          provider: langgenius/openai/openai
        prompt_template:
        - id: system-prompt
          role: system
          text: 'ã‚ãªãŸã¯ä¸å¯§ãªã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆæ‹…å½“è€…ã§ã™ã€‚
            åœ¨åº«çŠ¶æ³ã«é–¢ã™ã‚‹å•ã„åˆã‚ã›ã«å¯¾ã—ã¦ã€ä»¥ä¸‹ã®2ã¤ã®æ–‡ç« ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ï¼š

            1. é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡ï¼ˆåœ¨åº«ç¢ºèªä¸­ã§ã‚ã‚‹æ—¨ã‚’ä¸å¯§ã«èª¬æ˜ï¼‰
            2. ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ç¢ºèªä¾é ¼æ–‡ï¼ˆåœ¨åº«æ•°ã¨ç´æœŸã®ç¢ºèªï¼‰

            å¿…ãšä¸¡æ–¹ã®æ–‡ç« ã‚’ç”Ÿæˆã—ã€æ˜ç¢ºã«åŒºåˆ¥ã—ã¦ãã ã•ã„ã€‚'
        - id: user-prompt
          role: user
          text: 'ã€å•ã„åˆã‚ã›å†…å®¹ã€‘
            {{#start_node.inquiry_content#}}

            ã€é¡§å®¢æƒ…å ±ã€‘
            é¡§å®¢å: {{#start_node.customer_name#}}æ§˜

            ã€å•†å“æƒ…å ±ã€‘
            å•†å“å: {{#start_node.product_name#}}
            å‹ç•ª: {{#start_node.product_model#}}
            ãƒ¡ãƒ¼ã‚«ãƒ¼å: {{#start_node.manufacturer_name#}}

            ä¸Šè¨˜ã®å•ã„åˆã‚ã›ã«å¯¾ã—ã¦ã€é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡ã¨ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ç¢ºèªä¾é ¼æ–‡ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        structured_output_enabled: false
        title: åœ¨åº«çŠ¶æ³å¯¾å¿œæ–‡ç« ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 118
      id: stock_status_response_node
      position:
        x: 650
        y: 250
      positionAbsolute:
        x: 650
        y: 250
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: |
          def main(spec_response: str = None, stock_response: str = None, inquiry_type: str = "") -> dict:
              """
              ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ã‚’æ•´å½¢ãƒ»çµ±åˆ
              """
              from datetime import datetime
              
              # ç¾åœ¨æ—¥æ™‚ã®å–å¾—
              current_date = datetime.now().strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M")
              
              # ã©ã¡ã‚‰ã‹ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—
              response_text = spec_response if spec_response is not None else stock_response
              
              # response_textãŒNoneã®å ´åˆã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
              if response_text is None:
                  return {
                      "inquiry_type": "ä¸æ˜",
                      "customer_response": "ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚",
                      "manufacturer_request": "ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚Šç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚",
                      "processed_date": current_date,
                      "processing_status": "ã‚¨ãƒ©ãƒ¼"
                  }
              
              # å•ã„åˆã‚ã›ç¨®åˆ¥ã®åˆ¤å®š
              if spec_response is not None:
                  inquiry_type_label = "å•†å“ä»•æ§˜"
              elif stock_response is not None:
                  inquiry_type_label = "åœ¨åº«çŠ¶æ³"
              else:
                  inquiry_type_label = "ä¸æ˜"
              
              # æ–‡ç« ã®åˆ†é›¢å‡¦ç†
              if "ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘" in response_text:
                  parts = response_text.split("ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘")
                  if len(parts) >= 2:
                      customer_response = parts[0].replace("é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡", "").replace("é¡§å®¢å‘ã‘", "").strip()
                      manufacturer_request = "ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘" + parts[1]
                  else:
                      customer_response = response_text
                      manufacturer_request = "ãƒ¡ãƒ¼ã‚«ãƒ¼æ§˜ã¸ã®ç¢ºèªä¾é ¼æ–‡ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚"
              else:
                  # ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆ
                  customer_response = response_text
                  manufacturer_request = "ãƒ¡ãƒ¼ã‚«ãƒ¼æ§˜ã¸ã®ç¢ºèªä¾é ¼æ–‡ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚"
              
              # æ–‡ç« ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
              customer_response = customer_response.strip() if customer_response else ""
              manufacturer_request = manufacturer_request.strip() if manufacturer_request else ""
              
              return {
                  "inquiry_type": inquiry_type_label,
                  "customer_response": customer_response,
                  "manufacturer_request": manufacturer_request,
                  "processed_date": current_date,
                  "processing_status": "å®Œäº†"
              }
        code_language: python3
        desc: ç”Ÿæˆã•ã‚ŒãŸæ–‡ç« ã®çµ±åˆã¨æ•´å½¢
        error_strategy: fail-branch
        outputs:
          customer_response:
            children: null
            type: string
          inquiry_type:
            children: null
            type: string
          manufacturer_request:
            children: null
            type: string
          processed_date:
            children: null
            type: string
          processing_status:
            children: null
            type: string
        selected: false
        title: æ–‡ç« çµ±åˆå‡¦ç†
        type: code
        variables:
        - value_selector:
          - product_spec_response_node
          - text
          variable: spec_response
        - value_selector:
          - stock_status_response_node
          - text
          variable: stock_response
        - value_selector:
          - start_node
          - inquiry_content
          variable: inquiry_type
      height: 118
      id: response_integration_node
      position:
        x: 950
        y: 150
      positionAbsolute:
        x: 950
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '## ğŸ“§ å•ã„åˆã‚ã›å¯¾å¿œæ–‡ç« ç”Ÿæˆå®Œäº†

          **å•ã„åˆã‚ã›ç¨®åˆ¥**: {{#response_integration_node.inquiry_type#}}
          **å‡¦ç†æ—¥æ™‚**: {{#response_integration_node.processed_date#}}
          **å‡¦ç†çŠ¶æ…‹**: {{#response_integration_node.processing_status#}}

          ---

          ### ğŸ“ é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡

          {{#response_integration_node.customer_response#}}

          ---

          ### ğŸ­ ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ç¢ºèªä¾é ¼æ–‡

          {{#response_integration_node.manufacturer_request#}}

          ---

          ### ğŸ“‹ å•ã„åˆã‚ã›æƒ…å ±
          - **é¡§å®¢å**: {{#start_node.customer_name#}}æ§˜
          - **å•†å“å**: {{#start_node.product_name#}}
          - **å‹ç•ª**: {{#start_node.product_model#}}
          - **ãƒ¡ãƒ¼ã‚«ãƒ¼**: {{#start_node.manufacturer_name#}}

          ---

          ğŸ’¡ **æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**
          1. é¡§å®¢å‘ã‘è¿”ä¿¡æ–‡ã‚’ãƒ¡ãƒ¼ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ã‚³ãƒ”ãƒ¼
          2. ãƒ¡ãƒ¼ã‚«ãƒ¼å‘ã‘ç¢ºèªä¾é ¼æ–‡ã‚’é€ä¿¡
          3. å›ç­”å—é ˜å¾Œã€é¡§å®¢ã¸æœ€çµ‚å›ç­”

          âœ… æ–‡ç« ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚å†…å®¹ã‚’ã”ç¢ºèªã®ä¸Šã€é€ä¿¡ã—ã¦ãã ã•ã„ã€‚'
        desc: ''
        selected: false
        title: æœ€çµ‚å›ç­”
        type: answer
        variables: []
      height: 470
      id: final_answer_node
      position:
        x: 1250
        y: 150
      positionAbsolute:
        x: 1250
        y: 150
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: 0
      y: 0
      zoom: 0.8