app:
  description: ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒã‹ã‚‰æ—¥ä»˜ãƒ»é‡‘é¡ãƒ»å‹˜å®šç§‘ç›®ã‚’è‡ªå‹•æŠ½å‡ºã—ã€çµŒè²»ç®¡ç†CSVå½¢å¼ã§å‡ºåŠ›ã™ã‚‹OCRãƒœãƒƒãƒˆ
  icon: ğŸ§¾
  icon_background: '#8B5CF6'
  mode: advanced-chat
  name: é ˜åæ›¸OCRé›†è¨ˆãƒœãƒƒãƒˆ
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/openai:0.0.26@c1e643ac6a7732f6333a783320b4d3026fa5e31d8e7026375b98d44418d33f26
kind: app
version: 0.3.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .WEBP
      - .HEIC
      - .PDF
      allowed_file_types:
      - image
      - document
      allowed_file_upload_methods:
      - local_file
      enabled: true
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_size_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 10
    opening_statement: 'ã“ã‚“ã«ã¡ã¯ï¼é ˜åæ›¸OCRé›†è¨ˆãƒœãƒƒãƒˆã§ã™ã€‚

      ãƒ¬ã‚·ãƒ¼ãƒˆãƒ»é ˜åæ›¸ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã ã‘ã§ã€çµŒè²»ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•æŠ½å‡ºã—ã¾ã™ã€‚

      ğŸ“¸ ç”»åƒã‹ã‚‰è‡ªå‹•OCRèª­ã¿å–ã‚Š ğŸ’° é‡‘é¡ãƒ»æ—¥ä»˜ãƒ»åº—èˆ—åã‚’æŠ½å‡º ğŸ“Š å‹˜å®šç§‘ç›®ã‚’è‡ªå‹•åˆ†é¡ ğŸ“‹ çµŒè²»ç®¡ç†CSVå½¢å¼ã§å‡ºåŠ› ğŸ”„ è¤‡æ•°æšã®ä¸€æ‹¬å‡¦ç†å¯¾å¿œ

      ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ï¼'
    retriever_resource:
      enabled: false
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions:
    - é£²é£Ÿä»£ã®ãƒ¬ã‚·ãƒ¼ãƒˆã‚’å‡¦ç†ã—ã¦ãã ã•ã„
    - äº¤é€šè²»ã®é ˜åæ›¸ã‚’é›†è¨ˆãŠé¡˜ã„ã—ã¾ã™
    - äº‹å‹™ç”¨å“è³¼å…¥ã®ãƒ¬ã‚·ãƒ¼ãƒˆã‚’èª­ã¿å–ã£ã¦ãã ã•ã„
    suggested_questions_after_answer:
      enabled: true
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInLoop: false
        sourceType: start
        targetType: if-else
      id: start-filecheck-edge
      selected: false
      source: start_node
      sourceHandle: source
      target: file_check_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: answer
      id: filecheck-nofile-edge
      selected: false
      source: file_check_node
      sourceHandle: 'true'
      target: no_file_answer
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: if-else
        targetType: llm
      id: filecheck-ocr-edge
      selected: false
      source: file_check_node
      sourceHandle: 'false'
      target: ocr_analysis_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: parameter-extractor
      id: ocr-extract-edge
      selected: false
      source: ocr_analysis_node
      sourceHandle: source
      target: data_extraction_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: parameter-extractor
        targetType: code
      id: extract-category-edge
      selected: false
      source: data_extraction_node
      sourceHandle: source
      target: category_classification_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: code
      id: category-csv-edge
      selected: false
      source: category_classification_node
      sourceHandle: source
      target: csv_generation_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: code
        targetType: llm
      id: csv-summary-edge
      selected: false
      source: csv_generation_node
      sourceHandle: source
      target: expense_summary_node
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInLoop: false
        sourceType: llm
        targetType: answer
      id: summary-answer-edge
      selected: false
      source: expense_summary_node
      sourceHandle: source
      target: final_answer_node
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: 'ãƒ¬ã‚·ãƒ¼ãƒˆãƒ»é ˜åæ›¸ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

          è‡ªå‹•ã§OCRèª­ã¿å–ã‚Šã‚’è¡Œã„ã€çµŒè²»ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã™ã€‚'
        selected: false
        title: é–‹å§‹
        type: start
        variables:
        - allowed_file_extensions:
          - .JPG
          - .JPEG
          - .PNG
          - .WEBP
          - .HEIC
          - .PDF
          allowed_file_types:
          - image
          - document
          allowed_file_upload_methods:
          - local_file
          label: ãƒ¬ã‚·ãƒ¼ãƒˆãƒ»é ˜åæ›¸ç”»åƒ
          max_length: 10
          options: []
          required: true
          type: file
          variable: receipt_images
        - label: ç”³è«‹è€…å
          max_length: 50
          options: []
          required: false
          type: text-input
          variable: applicant_name
        - label: éƒ¨ç½²å
          max_length: 50
          options: []
          required: false
          type: text-input
          variable: department
      height: 218
      id: start_node
      position:
        x: 50
        y: 100
      positionAbsolute:
        x: 50
        y: 100
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        cases:
        - case_id: 'true'
          conditions:
          - comparison_operator: not exists
            id: file_check_condition
            value: ''
            varType: file
            variable_selector:
            - start_node
            - receipt_images
          id: 'true'
          logical_operator: and
        desc: ãƒ¬ã‚·ãƒ¼ãƒˆç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
        selected: false
        title: ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        type: if-else
      height: 154
      id: file_check_node
      position:
        x: 350
        y: 100
      positionAbsolute:
        x: 350
        y: 100
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: 'âŒ ãƒ¬ã‚·ãƒ¼ãƒˆãƒ»é ˜åæ›¸ã®ç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

          ğŸ“· ä»¥ä¸‹ã®å½¢å¼ã®ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ï¼š â€¢ JPEGãƒ»JPG (.jpg, .jpeg) â€¢ PNG (.png) â€¢ WebP (.webp)
          â€¢ HEIC (.heic) â€¢ PDF (.pdf)

          ğŸ’¡ OCRèª­ã¿å–ã‚Šã®ã‚³ãƒ„ï¼š â€¢ ç”»åƒã¯é®®æ˜ã§æ–‡å­—ãŒã¯ã£ãã‚Šè¦‹ãˆã‚‹ã‚‚ã® â€¢ ãƒ¬ã‚·ãƒ¼ãƒˆå…¨ä½“ãŒå†™ã£ã¦ã„ã‚‹ã‚‚ã® â€¢ å½±ã‚„åå°„ãŒãªã„æ˜ã‚‹ã„å ´æ‰€ã§æ’®å½± â€¢
          ä¸€åº¦ã«æœ€å¤§10æšã¾ã§å‡¦ç†å¯èƒ½

          ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã€å†åº¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚'
        desc: ''
        selected: false
        title: ãƒ•ã‚¡ã‚¤ãƒ«æœªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        type: answer
        variables: []
      height: 278
      id: no_file_answer
      position:
        x: 650
        y: 50
      positionAbsolute:
        x: 650
        y: 50
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: ç”»åƒã‹ã‚‰OCRã§ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’æŠ½å‡º
        model:
          completion_params:
            temperature: 0.1
          mode: chat
          name: gpt-4o
          provider: langgenius/openai/openai
        prompt_template:
        - id: system-prompt
          role: system
          text: 'ã‚ãªãŸã¯ãƒ¬ã‚·ãƒ¼ãƒˆãƒ»é ˜åæ›¸ã®OCRåˆ†æå°‚é–€å®¶ã§ã™ã€‚

            ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸç”»åƒã‹ã‚‰ä»¥ä¸‹ã®æƒ…å ±ã‚’æ­£ç¢ºã«èª­ã¿å–ã£ã¦ãã ã•ã„ï¼š

            ## æŠ½å‡ºå¯¾è±¡æƒ…å ± 1. **åº—èˆ—åãƒ»äº‹æ¥­è€…å**: ãƒ¬ã‚·ãƒ¼ãƒˆã®ä¸€ç•ªä¸Šã«è¨˜è¼‰ 2. **æ—¥ä»˜**: è³¼å…¥æ—¥ãƒ»ç™ºè¡Œæ—¥ 3. **æ™‚åˆ»**: è³¼å…¥æ™‚åˆ»ï¼ˆã‚ã‚Œã°ï¼‰
            4. **é‡‘é¡**: åˆè¨ˆé‡‘é¡ï¼ˆç¨è¾¼ã¿ï¼‰ 5. **å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹**: è³¼å…¥ã—ãŸå•†å“ã‚„ã‚µãƒ¼ãƒ“ã‚¹ 6. **æ”¯æ‰•æ–¹æ³•**: ç¾é‡‘ãƒ»ã‚«ãƒ¼ãƒ‰ãƒ»é›»å­ãƒãƒãƒ¼ç­‰
            7. **ä½æ‰€**: åº—èˆ—ä½æ‰€ï¼ˆã‚ã‚Œã°ï¼‰

            ## OCRèª­ã¿å–ã‚Šãƒ«ãƒ¼ãƒ« - æ–‡å­—ãŒä¸é®®æ˜ãªå ´åˆã¯ã€Œèª­ã¿å–ã‚Šå›°é›£ã€ã¨è¨˜è¼‰ - æ•°å­—ã¯æ­£ç¢ºã«æŠ½å‡ºï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã‚‚å«ã‚€ï¼‰ - æ—¥ä»˜ã¯ YYYY/MM/DD
            å½¢å¼ã§çµ±ä¸€ - é‡‘é¡ã¯æ•°å­—ã®ã¿æŠ½å‡ºï¼ˆÂ¥ãƒãƒ¼ã‚¯ã¯é™¤ãï¼‰

            ## å‡ºåŠ›å½¢å¼ **åº—èˆ—å**: [åº—èˆ—å] **æ—¥ä»˜**: [YYYY/MM/DD] **æ™‚åˆ»**: [HH:MM] **åˆè¨ˆé‡‘é¡**:
            [é‡‘é¡ï¼ˆæ•°å­—ã®ã¿ï¼‰] **å•†å“å†…å®¹**: [å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ä¸€è¦§] **æ”¯æ‰•æ–¹æ³•**: [æ”¯æ‰•ã„æ–¹æ³•] **ä½æ‰€**: [åº—èˆ—ä½æ‰€]

            è¤‡æ•°ã®ç”»åƒãŒã‚ã‚‹å ´åˆã¯ã€ãã‚Œãã‚Œåˆ†ã‘ã¦æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚'
        - id: user-prompt
          role: user
          text: 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ¬ã‚·ãƒ¼ãƒˆãƒ»é ˜åæ›¸ç”»åƒã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

            ç”³è«‹è€…: {{#start_node.applicant_name#}} éƒ¨ç½²: {{#start_node.department#}}

            æ­£ç¢ºãªOCRèª­ã¿å–ã‚Šã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚'
        selected: false
        structured_output_enabled: false
        title: OCRç”»åƒè§£æ
        type: llm
        variables: []
        vision:
          configs:
            detail: high
            variable_selector:
            - start_node
            - receipt_images
          enabled: true
      height: 118
      id: ocr_analysis_node
      position:
        x: 650
        y: 180
      positionAbsolute:
        x: 650
        y: 180
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: OCRçµæœã‹ã‚‰æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
        instruction: 'OCRã§èª­ã¿å–ã£ãŸãƒ¬ã‚·ãƒ¼ãƒˆæƒ…å ±ã‹ã‚‰ã€çµŒè²»ç²¾ç®—ã«å¿…è¦ãªæ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

          è¤‡æ•°ã®ãƒ¬ã‚·ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆã¯ã€æœ€åˆã®ãƒ¬ã‚·ãƒ¼ãƒˆã®æƒ…å ±ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

          æ—¥ä»˜ã‚„é‡‘é¡ãŒèª­ã¿å–ã‚Œãªã„å ´åˆã¯ã€Œä¸æ˜ã€ã¨è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚'
        model:
          completion_params:
            temperature: 0.1
          mode: chat
          name: gpt-4
          provider: langgenius/openai/openai
        parameters:
        - description: åº—èˆ—åãƒ»äº‹æ¥­è€…å
          name: store_name
          required: false
          type: string
        - description: è³¼å…¥æ—¥ï¼ˆYYYY-MM-DDå½¢å¼ï¼‰
          name: purchase_date
          required: false
          type: string
        - description: è³¼å…¥æ™‚åˆ»ï¼ˆHH:MMå½¢å¼ï¼‰
          name: purchase_time
          required: false
          type: string
        - description: åˆè¨ˆé‡‘é¡ï¼ˆæ•°å­—ã®ã¿ï¼‰
          name: total_amount
          required: false
          type: number
        - description: å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹
          name: items_description
          required: false
          type: string
        - description: æ”¯æ‰•æ–¹æ³•
          name: payment_method
          required: false
          type: string
        - description: åº—èˆ—ä½æ‰€
          name: store_address
          required: false
          type: string
        - description: ãƒ¬ã‚·ãƒ¼ãƒˆæšæ•°
          name: receipt_count
          required: false
          type: number
        query:
        - ocr_analysis_node
        - text
        reasoning_mode: prompt
        selected: false
        title: ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºå‡¦ç†
        type: parameter-extractor
        variables: []
        vision:
          enabled: false
      height: 118
      id: data_extraction_node
      position:
        x: 950
        y: 180
      positionAbsolute:
        x: 950
        y: 180
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "def main(store_name: str, items_description: str, total_amount: float)\
          \ -> dict:\n    \"\"\"\n    åº—èˆ—åã¨å•†å“å†…å®¹ã‹ã‚‰å‹˜å®šç§‘ç›®ã‚’è‡ªå‹•åˆ†é¡\n    \"\"\"\n    import\
          \ re\n    \n    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®š\n    if not store_name:\n        store_name\
          \ = \"ä¸æ˜\"\n    if not items_description:\n        items_description = \"\
          ä¸æ˜\"\n    if not total_amount or total_amount <= 0:\n        total_amount\
          \ = 0\n    \n    # å‹˜å®šç§‘ç›®åˆ†é¡ãƒ«ãƒ¼ãƒ«\n    category_rules = {\n        \"äº¤é€šè²»\": [\n\
          \            \"JR\", \"ç§é‰„\", \"åœ°ä¸‹é‰„\", \"ãƒã‚¹\", \"ã‚¿ã‚¯ã‚·ãƒ¼\", \"é›»è»Š\", \"æ–°å¹¹ç·š\"\
          ,\n            \"é§…\", \"äº¤é€š\", \"é‹è³ƒ\", \"ä¹—è»Šåˆ¸\", \"å®šæœŸ\", \"å›æ•°åˆ¸\", \"IC\",\n\
          \            \"ã‚¹ã‚¤ã‚«\", \"ãƒ‘ã‚¹ãƒ¢\", \"ã‚¤ã‚³ã‚«\", \"é«˜é€Ÿ\", \"ETC\", \"ã‚¬ã‚½ãƒªãƒ³\"\n    \
          \    ],\n        \"ä¼šè­°è²»\": [\n            \"ä¼šè­°\", \"æ‰“ã¡åˆã‚ã›\", \"ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°\",\
          \ \"å•†è«‡\", \"ç›¸è«‡\", \"é¢è«‡\",\n            \"å–«èŒ¶\", \"ã‚«ãƒ•ã‚§\", \"ã‚³ãƒ¼ãƒ’ãƒ¼\", \"tea\"\
          , \"coffee\", \"ã‚¹ã‚¿ãƒ\", \"ãƒ‰ãƒˆãƒ¼ãƒ«\"\n        ],\n        \"æ¥å¾…äº¤éš›è²»\": [\n    \
          \        \"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³\", \"å±…é…’å±‹\", \"ç„¼è‚‰\", \"å¯¿å¸\", \"æ–™äº­\", \"å®´ä¼š\", \"ãƒ‘ãƒ¼ãƒ†ã‚£\",\n\
          \            \"æ¥å¾…\", \"æ‡‡è¦ª\", \"æ­“é€è¿\", \"å¿˜å¹´ä¼š\", \"æ–°å¹´ä¼š\", \"é£Ÿäº‹\", \"é£²é£Ÿ\",\n\
          \            \"ãƒ›ãƒ†ãƒ«\", \"å®¿æ³Š\", \"æ—…é¤¨\", \"inn\"\n        ],\n        \"æ¶ˆè€—å“è²»\"\
          : [\n            \"æ–‡å…·\", \"ãƒšãƒ³\", \"ãƒãƒ¼ãƒˆ\", \"ç´™\", \"ã‚³ãƒ”ãƒ¼\", \"å°åˆ·\", \"ãƒˆãƒŠãƒ¼\"\
          , \"ã‚¤ãƒ³ã‚¯\",\n            \"ãƒ•ã‚¡ã‚¤ãƒ«\", \"å°ç­’\", \"ã¯ã•ã¿\", \"ãƒ›ãƒã‚­ã‚¹\", \"é›»æ± \", \"\
          USB\",\n            \"äº‹å‹™ç”¨å“\", \"ã‚ªãƒ•ã‚£ã‚¹\", \"100å††\", \"ã‚³ãƒ³ãƒ“ãƒ‹\"\n        ],\n\
          \        \"é€šä¿¡è²»\": [\n            \"æºå¸¯\", \"ã‚¹ãƒãƒ›\", \"é›»è©±\", \"ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ\", \"\
          wifi\", \"ãƒ—ãƒ­ãƒã‚¤ãƒ€\",\n            \"docomo\", \"au\", \"softbank\", \"æ¥½å¤©\"\
          , \"é€šä¿¡\", \"ãƒ‡ãƒ¼ã‚¿\"\n        ],\n        \"æ°´é“å…‰ç†±è²»\": [\n            \"é›»æ°—\"\
          , \"ã‚¬ã‚¹\", \"æ°´é“\", \"å…‰ç†±\", \"æ±äº¬é›»åŠ›\", \"æ±äº¬ã‚¬ã‚¹\", \"é–¢è¥¿é›»åŠ›\"\n        ],\n   \
          \     \"ç ”ä¿®è²»\": [\n            \"ç ”ä¿®\", \"ã‚»ãƒŸãƒŠãƒ¼\", \"è¬›ç¿’\", \"å‹‰å¼·ä¼š\", \"ã‚¹ã‚¯ãƒ¼ãƒ«\"\
          , \"è¬›åº§\", \"è³‡æ ¼\",\n            \"æ¤œå®š\", \"è©¦é¨“\", \"æ•™è‚²\", \"å­¦ç¿’\", \"æ›¸ç±\", \"\
          æœ¬\"\n        ],\n        \"åºƒå‘Šå®£ä¼è²»\": [\n            \"åºƒå‘Š\", \"å®£ä¼\", \"PR\"\
          , \"ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°\", \"ãƒãƒ©ã‚·\", \"ãƒ‘ãƒ³ãƒ•ãƒ¬ãƒƒãƒˆ\",\n            \"ååˆº\", \"çœ‹æ¿\", \"ãƒã‚¹ã‚¿ãƒ¼\"\
          , \"WEB\", \"SNS\"\n        ]\n    }\n    \n    # åˆ†é¡å®Ÿè¡Œ\n    detected_category\
          \ = \"ãã®ä»–\"\n    confidence_score = 0\n    \n    search_text = f\"{store_name}\
          \ {items_description}\".lower()\n    \n    for category, keywords in category_rules.items():\n\
          \        matches = 0\n        for keyword in keywords:\n            if keyword.lower()\
          \ in search_text:\n                matches += 1\n        \n        # ãƒãƒƒãƒåº¦ã®è¨ˆç®—\n\
          \        match_score = (matches / len(keywords)) * 100\n        if match_score\
          \ > confidence_score:\n            confidence_score = match_score\n    \
          \        detected_category = category\n    \n    # é‡‘é¡ã«ã‚ˆã‚‹è¿½åŠ åˆ¤å®š\n    if total_amount\
          \ > 0:\n        if total_amount >= 10000 and \"ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³\" in search_text:\n\
          \            detected_category = \"æ¥å¾…äº¤éš›è²»\"\n            confidence_score\
          \ = max(confidence_score, 80)\n        elif total_amount <= 500 and any(word\
          \ in search_text for word in [\"ã‚³ãƒ³ãƒ“ãƒ‹\", \"100å††\"]):\n            detected_category\
          \ = \"æ¶ˆè€—å“è²»\"\n            confidence_score = max(confidence_score, 75)\n\
          \    \n    # ä¿¡é ¼åº¦ãŒä½ã„å ´åˆã¯ã€Œãã®ä»–ã€ã«è¨­å®š\n    if confidence_score < 20:\n        detected_category\
          \ = \"ãã®ä»–\"\n        confidence_score = 0\n    \n    # ç¨åŒºåˆ†ã®åˆ¤å®š\n    tax_category\
          \ = \"èª²ç¨\" if total_amount > 0 else \"ä¸æ˜\"\n    if any(word in search_text\
          \ for word in [\"äº¤é€š\", \"é›»è»Š\", \"ãƒã‚¹\"]):\n        tax_category = \"éèª²ç¨\"\
          \n    \n    return {\n        \"account_category\": detected_category,\n\
          \        \"confidence_score\": round(confidence_score, 1),\n        \"tax_category\"\
          : tax_category,\n        \"processed_amount\": total_amount,\n        \"\
          classification_keywords\": [kw for kw in category_rules.get(detected_category,\
          \ []) if kw.lower() in search_text][:3]\n    }\n"
        code_language: python3
        desc: å‹˜å®šç§‘ç›®ã®è‡ªå‹•åˆ†é¡å‡¦ç†
        error_strategy: fail-branch
        outputs:
          account_category:
            children: null
            type: string
          classification_keywords:
            children: null
            type: array[string]
          confidence_score:
            children: null
            type: number
          processed_amount:
            children: null
            type: number
          tax_category:
            children: null
            type: string
        selected: false
        title: å‹˜å®šç§‘ç›®åˆ†é¡
        type: code
        variables:
        - value_selector:
          - data_extraction_node
          - store_name
          variable: store_name
        - value_selector:
          - data_extraction_node
          - items_description
          variable: items_description
        - value_selector:
          - data_extraction_node
          - total_amount
          variable: total_amount
      height: 118
      id: category_classification_node
      position:
        x: 1250
        y: 180
      positionAbsolute:
        x: 1250
        y: 180
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "def main(store_name: str, purchase_date: str, total_amount: float,\
          \ \n         account_category: str, tax_category: str, items_description:\
          \ str,\n         applicant_name: str, department: str, payment_method: str)\
          \ -> dict:\n    \"\"\"\n    çµŒè²»ç®¡ç†CSVå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ\n    \"\"\"\n    from datetime\
          \ import datetime\n    import csv\n    import io\n    \n    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®è¨­å®š\n\
          \    if not applicant_name:\n        applicant_name = \"æœªå…¥åŠ›\"\n    if not\
          \ department:\n        department = \"æœªå…¥åŠ›\"\n    if not purchase_date:\n\
          \        purchase_date = datetime.now().strftime(\"%Y-%m-%d\")\n    if not\
          \ store_name:\n        store_name = \"ä¸æ˜\"\n    if not payment_method:\n\
          \        payment_method = \"ä¸æ˜\"\n    if not items_description:\n      \
          \  items_description = \"ä¸æ˜\"\n    \n    # CSVãƒ˜ãƒƒãƒ€ãƒ¼å®šç¾©\n    csv_headers =\
          \ [\n        \"ç”³è«‹æ—¥\",\n        \"ç”³è«‹è€…\", \n        \"éƒ¨ç½²\",\n        \"ä½¿ç”¨æ—¥\"\
          ,\n        \"åº—èˆ—å\",\n        \"é‡‘é¡\",\n        \"å‹˜å®šç§‘ç›®\",\n        \"ç¨åŒºåˆ†\"\
          ,\n        \"æ‘˜è¦\",\n        \"æ”¯æ‰•æ–¹æ³•\",\n        \"æ‰¿èªçŠ¶æ³\"\n    ]\n    \n \
          \   # ç”³è«‹æ—¥ï¼ˆä»Šæ—¥ã®æ—¥ä»˜ï¼‰\n    application_date = datetime.now().strftime(\"%Y-%m-%d\"\
          )\n    \n    # CSVè¡Œãƒ‡ãƒ¼ã‚¿ä½œæˆ\n    csv_row = [\n        application_date,\n \
          \       applicant_name,\n        department,\n        purchase_date,\n \
          \       store_name,\n        int(total_amount) if total_amount and total_amount\
          \ > 0 else 0,\n        account_category,\n        tax_category,\n      \
          \  items_description[:50] + (\"...\" if len(items_description) > 50 else\
          \ \"\"),  # æ‘˜è¦ã¯50æ–‡å­—åˆ¶é™\n        payment_method,\n        \"ç”³è«‹ä¸­\"\n    ]\n\
          \    \n    # CSVæ–‡å­—åˆ—ç”Ÿæˆ\n    output = io.StringIO()\n    writer = csv.writer(output)\n\
          \    writer.writerow(csv_headers)\n    writer.writerow(csv_row)\n    csv_content\
          \ = output.getvalue()\n    output.close()\n    \n    # çµ±è¨ˆæƒ…å ±ã®è¨ˆç®—\n    expense_summary\
          \ = {\n        \"total_count\": 1,\n        \"total_amount\": total_amount\
          \ if total_amount else 0,\n        \"categories\": [account_category],\n\
          \        \"average_amount\": total_amount if total_amount else 0\n    }\n\
          \    \n    return {\n        \"csv_content\": csv_content,\n        \"csv_filename\"\
          : f\"çµŒè²»ç²¾ç®—_{applicant_name}_{application_date}.csv\",\n        \"expense_summary\"\
          : expense_summary,\n        \"processing_date\": application_date,\n   \
          \     \"record_count\": 1\n    }\n"
        code_language: python3
        desc: çµŒè²»ç®¡ç†CSVå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›
        error_strategy: fail-branch
        outputs:
          csv_content:
            children: null
            type: string
          csv_filename:
            children: null
            type: string
          expense_summary:
            children: null
            type: object
          processing_date:
            children: null
            type: string
          record_count:
            children: null
            type: number
        selected: false
        title: CSVç”Ÿæˆå‡¦ç†
        type: code
        variables:
        - value_selector:
          - data_extraction_node
          - store_name
          variable: store_name
        - value_selector:
          - data_extraction_node
          - purchase_date
          variable: purchase_date
        - value_selector:
          - data_extraction_node
          - total_amount
          variable: total_amount
        - value_selector:
          - category_classification_node
          - account_category
          variable: account_category
        - value_selector:
          - category_classification_node
          - tax_category
          variable: tax_category
        - value_selector:
          - data_extraction_node
          - items_description
          variable: items_description
        - value_selector:
          - start_node
          - applicant_name
          variable: applicant_name
        - value_selector:
          - start_node
          - department
          variable: department
        - value_selector:
          - data_extraction_node
          - payment_method
          variable: payment_method
      height: 118
      id: csv_generation_node
      position:
        x: 1550
        y: 180
      positionAbsolute:
        x: 1550
        y: 180
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: çµŒè²»å‡¦ç†çµæœã®ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
        model:
          completion_params:
            temperature: 0.3
          mode: chat
          name: gpt-4
          provider: langgenius/openai/openai
        prompt_template:
        - id: system-prompt
          role: system
          text: 'çµŒè²»ç²¾ç®—å‡¦ç†ã®çµæœã‚’ã‚ã‹ã‚Šã‚„ã™ãã¾ã¨ã‚ã¦ãã ã•ã„ã€‚

            ## å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ **ğŸ“‹ å‡¦ç†çµæœã‚µãƒãƒªãƒ¼** - ç”³è«‹è€…: [ç”³è«‹è€…å] - å‡¦ç†æ—¥: [å‡¦ç†æ—¥] - ç·é‡‘é¡: Â¥[é‡‘é¡]

            **ğŸ“Š å‹˜å®šç§‘ç›®åˆ†æ** - åˆ†é¡: [å‹˜å®šç§‘ç›®] - ä¿¡é ¼åº¦: [ä¿¡é ¼åº¦]% - ç¨åŒºåˆ†: [ç¨åŒºåˆ†]

            **ğŸ’¡ ç¢ºèªãƒã‚¤ãƒ³ãƒˆ** - [ç¢ºèªã™ã¹ãç‚¹ã‚„æ³¨æ„äº‹é …]

            **âœ… æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—** - [çµŒè²»ç”³è«‹ã®æ¬¡ã®æ‰‹é †]'
        - id: user-prompt
          role: user
          text: 'ã€æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã€‘ åº—èˆ—å: {{#data_extraction_node.store_name#}} æ—¥ä»˜: {{#data_extraction_node.purchase_date#}}
            é‡‘é¡: {{#data_extraction_node.total_amount#}}å†† å•†å“å†…å®¹: {{#data_extraction_node.items_description#}}

            ã€åˆ†é¡çµæœã€‘ å‹˜å®šç§‘ç›®: {{#category_classification_node.account_category#}} ä¿¡é ¼åº¦:
            {{#category_classification_node.confidence_score#}}% ç¨åŒºåˆ†: {{#category_classification_node.tax_category#}}

            ã€CSVå‡ºåŠ›ã€‘ ãƒ•ã‚¡ã‚¤ãƒ«å: {{#csv_generation_node.csv_filename#}} å‡¦ç†æ—¥: {{#csv_generation_node.processing_date#}}

            ä¸Šè¨˜ã®çµæœã‚’åŸºã«ã€å‡¦ç†ã‚µãƒãƒªãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚'
        selected: false
        structured_output_enabled: false
        title: çµŒè²»ã‚µãƒãƒªãƒ¼ç”Ÿæˆ
        type: llm
        variables: []
        vision:
          enabled: false
      height: 118
      id: expense_summary_node
      position:
        x: 1850
        y: 180
      positionAbsolute:
        x: 1850
        y: 180
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        answer: '## ğŸ§¾ é ˜åæ›¸OCRå‡¦ç†å®Œäº†ï¼

          {{#expense_summary_node.text#}}

          ---

          ### ğŸ“„ ç”Ÿæˆã•ã‚ŒãŸCSVãƒ‡ãƒ¼ã‚¿ **ãƒ•ã‚¡ã‚¤ãƒ«å**: {{#csv_generation_node.csv_filename#}}

          ```csv {{#csv_generation_node.csv_content#}} ```

          ---

          ### ğŸ” OCRèª­ã¿å–ã‚Šè©³ç´° **åº—èˆ—å**: {{#data_extraction_node.store_name#}} **æ—¥æ™‚**: {{#data_extraction_node.purchase_date#}}
          {{#data_extraction_node.purchase_time#}} **æ”¯æ‰•æ–¹æ³•**: {{#data_extraction_node.payment_method#}}
          **å•†å“å†…å®¹**: {{#data_extraction_node.items_description#}}

          ### ğŸ¯ è‡ªå‹•åˆ†é¡çµæœ **å‹˜å®šç§‘ç›®**: {{#category_classification_node.account_category#}}
          **åˆ†é¡ä¿¡é ¼åº¦**: {{#category_classification_node.confidence_score#}}% **ç¨åŒºåˆ†**:
          {{#category_classification_node.tax_category#}} **åˆ¤å®šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰**: {{#category_classification_node.classification_keywords#}}

          ---

          ğŸ’¡ **ã“ã®CSVãƒ‡ãƒ¼ã‚¿ã‚’çµŒè²»ç²¾ç®—ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¾ã™ï¼** ğŸ“ **å†…å®¹ã«é–“é•ã„ãŒã‚ã‚‹å ´åˆã¯æ‰‹å‹•ã§ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚**'
        desc: ''
        selected: false
        title: OCRå‡¦ç†çµæœ
        type: answer
        variables: []
      height: 538
      id: final_answer_node
      position:
        x: 2150
        y: 180
      positionAbsolute:
        x: 2150
        y: 180
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: 146.1105548191207
      y: 52.29224231949348
      zoom: 1.1250584846888103
