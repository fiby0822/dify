# コーディングルール改善案 - 音声認識・画像認識機能追加

## 実施日
2025年7月4日

## 改善概要
音声認識および画像認識（OCR/Vision）機能のコンポーネント別コーディングルールを追加し、
marketplace_plugin（lysonober/openai_audio）の特別許可を全体ルールに反映しました。

## 実施内容

### 1. 新規コンポーネントルールの追加

#### 1.1 音声認識コンポーネントルール
- **ファイル**: `/コンポーネント別コーディングルール/コンポーネント記述ルール_音声認識.txt`
- **内容**:
  - OpenAI Audio APIを使用した音声文字起こし機能の記述ルール
  - marketplaceプラグイン（lysonober/openai_audio）の使用方法
  - 3つのモデル（gpt-4o-transcribe、gpt-4o-mini-transcribe、whisper-1）の選択ガイドライン
  - 音声ファイルアップロード設定（最大25MB）
  - エラーハンドリングとベストプラクティス

#### 1.2 画像認識コンポーネントルール
- **ファイル**: `/コンポーネント別コーディングルール/コンポーネント記述ルール_画像認識.txt`
- **内容**:
  - LLMのVision機能を使用した画像認識・OCR処理の記述ルール
  - 画像ファイルアップロード設定（最大10MB）
  - Vision設定の詳細（detail: high/low）
  - OCR処理と画像分析のユースケース別設定例
  - 推奨ワークフロー構成

### 2. 全体ルールの更新

#### 2.1 外部連携とツール（06_外部連携とツール.md）
- **marketplace_plugin一覧への追加**:
  - lysonober/openai_audio | 音声文字起こし（特別許可） | 0.0.4
- **音声認識ツールセクション（26.6）の新規追加**:
  - 依存関係の宣言方法
  - ツールノードの設定例
  - 使用上の注意事項

### 3. 品質チェックへの反映

#### 3.1 品質チェックリスト.md
- **マーケットプレイスツールの依存関係確認**に以下を追加:
  - 音声認識を使用する場合、lysonober/openai_audio:0.0.4@2a7bc1307f6d4337b597cafe1c75f20e0fabf0dd8132a0a4e04496b3c949c86c のみ使用（特別許可）

#### 3.2 クラッシュ事項チェックリスト.md
- **音声認識（OpenAI Audio）固有の例**セクションを追加:
  - 正しい依存関係設定の例
  - marketplace_plugin_unique_identifierの完全一致の重要性

## 技術的な注意点

### 1. marketplace_pluginの扱い
- **原則**: marketplaceプラグインの使用は禁止
- **例外**: 以下の2つのみ特別許可
  - omluc/google_sheets:0.0.2（Google Sheets操作）
  - lysonober/openai_audio:0.0.4（音声認識）
- **重要**: provider_typeは"builtin"を使用（"marketplace"ではない）

### 2. 音声認識の実装時の注意
- dependenciesでtype: marketplaceとして宣言
- toolノードではprovider_type: builtinを使用
- ファイルサイズ制限は25MB
- ストリーミングはGPT-4oモデルのみサポート

### 3. 画像認識の実装時の注意
- 通常のLLMノード + Vision機能で実装
- vision.enabled: trueが必須
- detail設定でOCR精度を調整（high推奨）
- PDFファイルもOCR処理可能

## 影響範囲

### 更新ファイル一覧
1. `/コンポーネント別コーディングルール/コンポーネント記述ルール_音声認識.txt`（新規）
2. `/コンポーネント別コーディングルール/コンポーネント記述ルール_画像認識.txt`（新規）
3. `/全体コーディングルール/06_外部連携とツール.md`（更新）
4. `/品質チェック/品質チェックリスト.md`（更新）
5. `/品質チェック/クラッシュ事項チェックリスト.md`（更新）

### 互換性
- 既存のルールとの互換性は維持
- 新機能を使用しない場合は影響なし
- 既存のmarketplace禁止ルールは維持（例外のみ追加）

## 推奨事項

### 開発者向け
1. 音声認識が必要な場合は、lysonober/openai_audioプラグインを使用
2. 画像認識・OCRが必要な場合は、LLMのVision機能を使用
3. 両機能とも適切なエラーハンドリングを実装すること
4. ファイルサイズ制限を考慮した設計を行うこと

### レビュアー向け
1. dependenciesセクションでの正しい宣言を確認
2. provider_typeがbuiltinになっているか確認
3. Vision機能使用時のenabled設定を確認
4. ファイルアップロード設定の適切性を確認

## 今後の検討事項
1. 他の有用なmarketplaceプラグインの評価と許可検討
2. 音声・画像処理のベストプラクティスの蓄積
3. パフォーマンス最適化のガイドライン策定