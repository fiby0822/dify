# 全体コーディングルール リファクタリング案

## 現状の問題点
- 現在のファイル: 2,722行、33,000トークン超
- エラー: ファイルサイズが大きすぎて読み込めない（25,000トークン制限）
- 影響: 効率的な参照・更新が困難

## リファクタリング方針
1. **ルールの内容は一切削減しない**（元の意味を完全に保持）
2. **機能別にファイル分割**して読み込み可能なサイズに調整
3. **相互参照を明確化**して使いやすさを向上
4. **重複部分を統合**して全体サイズを最適化

## 提案するファイル構成

### 00_index.md（目次・クイックリファレンス）
- 全体構成の説明
- 各ファイルへのリンク
- クイックスタートガイド
- よく使う項目への索引
推定サイズ: 約1,000トークン

### 01_基本構造とエラー防止.md
含まれるセクション:
- セクション0: よくある失敗パターン（必読）
- セクション2: YAMLファイル基本構造
- セクション3: 命名規則
- セクション13: 型定義リファレンス（基本部分）
- セクション14: 最小構成テンプレート
推定サイズ: 約8,000トークン

### 02_ワークフロー設計.md
含まれるセクション:
- セクション4: ワークフロー設計原則
- セクション5: ナレッジベース管理
- セクション16: システム変数リファレンス
- セクション17: モード別ベストプラクティス
- セクション18: コード実行ノードの注意事項
推定サイズ: 約7,000トークン

### 03_変数とデータ管理.md
含まれるセクション:
- セクション6: 変数管理
- 変数参照形式の詳細
- 変数スコープの説明
- データ型と変換規則
推定サイズ: 約2,000トークン

### 04_品質とセキュリティ.md
含まれるセクション:
- セクション7: 品質管理
- セクション8: セキュリティ考慮事項
- セクション9: パフォーマンス最適化
- セクション11: 互換性とアップデート
推定サイズ: 約3,000トークン

### 05_トラブルシューティング.md
含まれるセクション:
- セクション12: トラブルシューティング指針（全体）
- セクション20: 最終チェックリスト
- セクション21: よくある質問（FAQ）
- エラー別対処法の詳細
推定サイズ: 約7,000トークン

### 06_外部連携とツール.md
含まれるセクション:
- セクション24: マーケットプレイス依存関係管理
- セクション25: トークン数管理とモデル選択
- セクション26: 外部ツール（Tool）ノードの使用
推定サイズ: 約4,000トークン

### 07_ドキュメントと設定.md
含まれるセクション:
- セクション10: ドキュメント化
- セクション15: 開発時の推奨フロー
- セクション19: パフォーマンスと拡張性
- セクション22: デバッグ設定管理
- セクション23: hashフィールドの取り扱い
推定サイズ: 約2,000トークン

### 08_詳細リファレンス.md
含まれるセクション:
- セクション13: 型定義リファレンス（詳細版）
- 全フィールドの完全な仕様
- 属性値の有効範囲
- バージョン別の差異
推定サイズ: 約3,000トークン

## 実装上の工夫

### 1. 相互参照の実装
各ファイルの冒頭に関連ファイルへのリンクを配置:
```
関連ファイル:
- [基本構造とエラー防止](./01_基本構造とエラー防止.md)
- [トラブルシューティング](./05_トラブルシューティング.md)
```

### 2. 重複の削減方法
- 同じ内容が複数箇所にある場合、主となる場所に記載し、他は参照
- 例: エラー対処法は05_トラブルシューティング.mdに集約

### 3. 検索性の向上
- 各ファイルに検索用キーワードリストを追加
- インデックスファイルに全体検索ガイドを記載

### 4. 段階的移行
1. まず新構成でファイルを作成
2. 既存ファイルと並行運用して検証
3. 問題がなければ完全移行

## 効果
- **読み込み可能**: 各ファイル25,000トークン以下
- **保守性向上**: 機能別に整理され更新が容易
- **検索性向上**: 目的別にファイルが分かれている
- **学習効率向上**: 段階的に必要な部分から学習可能

## 実装優先順位
1. 00_index.md（全体の道しるべ）
2. 01_基本構造とエラー防止.md（最も重要）
3. 05_トラブルシューティング.md（頻繁に参照）
4. 02_ワークフロー設計.md（実装時に必須）
5. その他のファイル（順次作成）

## 移行スケジュール案
- Phase 1: インデックスと基本構造ファイルの作成（1日）
- Phase 2: 残りのファイルの作成（2日）
- Phase 3: 検証と微調整（1日）
- Phase 4: 完全移行（1日）

合計: 約5日間での移行を想定