コーディングルール改善案

■分析結果の概要
動作エラーとなった4つのケースすべてにおいて、toolノード（Tavily Search）の必須フィールド欠落が原因でした。
現行のコーディングルールでは、これらの必須フィールドについての記載が不十分であることが判明しました。

■改善が必要なルール箇所

1. **コンポーネント記述ルール_WEB検索.txt の改善点**

【現状の問題点】
- provider_nameフィールドの必須性が記載されていない
- tool_labelフィールドの必須性が記載されていない
- tool_parametersとtool_configurationsの使い分けが不明確
- paramSchemasセクションについての言及がない

【改善案】
以下のセクションを追加：

```
■追加必須パラメータ（重要）

1. provider_name: string
   - 必須フィールド
   - provider_idと同じ値を設定
   - 例: "langgenius/tavily/tavily"

2. tool_label: string
   - 必須フィールド
   - UIに表示されるツール名
   - 例: "Tavily Search"

3. tool_description: string
   - 推奨フィールド
   - ツールの説明文

4. paramSchemas: array
   - 動的に生成される場合があるため、手動設定は不要
   - Difyが自動的に生成する場合が多い

■tool_parametersとtool_configurationsの使い分け（重要）

1. tool_parameters:
   - 動的な値（実行時に変わる値）のみを設定
   - 各値は必ず辞書形式で記述
   - 主にqueryパラメータのみ
   例：
   ```yaml
   tool_parameters:
     query:
       type: mixed
       value: '{{#sys.query#}}'
   ```

2. tool_configurations:
   - 静的な設定値を記述
   - search_depth、topic、max_resultsなどの固定値
   - boolean値は数値（0/1）で指定
   例：
   ```yaml
   tool_configurations:
     search_depth: basic
     topic: general
     max_results: 5
     include_answer: 0
     include_images: 0
   ```
```

2. **品質チェックリスト.md の改善点**

【追加すべきチェック項目】
```markdown
### 4.8 toolノード（外部ツール）- 追加項目
- [ ] **provider_nameフィールドが設定されている（provider_idと同じ値）**
- [ ] **tool_labelフィールドが設定されている**
- [ ] **tool_parametersには動的値（query等）のみが辞書形式で設定されている**
- [ ] **静的な設定値はtool_configurationsに移動している**
- [ ] **tool_parametersの各値にtype/valueが含まれている**
```

3. **クラッシュ事項チェックリスト.md の改善点**

【追加すべきチェック項目】
```markdown
## 13. toolノード関連のクラッシュ防止 - 追加項目

### 13.5 必須フィールドの確認（最重要）
- [ ] **provider_nameフィールドが存在する（provider_idの値をコピー）**
- [ ] **tool_labelフィールドが存在する**
- [ ] **tool_parametersの値がすべて辞書形式（type/value構造）**
- [ ] **静的設定がtool_parametersではなくtool_configurationsに配置**

### 13.6 パラメータ形式の誤り（頻出エラー）
- [ ] **tool_parametersに直接値を設定していない**
  ```yaml
  # ❌ 間違い
  tool_parameters:
    search_depth: basic
    max_results: 5
    
  # ✅ 正解
  tool_parameters:
    query:
      type: mixed
      value: '{{#sys.query#}}'
  ```
```

4. **全体コーディングルール.md の改善点**

【追加すべきセクション】
```markdown
## 25. toolノードの正しい実装パターン（新規追加）

### 25.1 必須フィールドの完全リスト
toolノードには以下のフィールドが必須です：
- provider_id
- provider_name（provider_idと同じ値）
- provider_type
- tool_name
- tool_label
- tool_parameters（動的値のみ、辞書形式）
- tool_configurations（静的設定値）
- is_team_authorization

### 25.2 パラメータ設定の正しいパターン
```yaml
# 正しい実装例
- data:
    provider_id: langgenius/tavily/tavily
    provider_name: langgenius/tavily/tavily  # 必須：provider_idと同じ
    provider_type: builtin
    tool_name: tavily_search
    tool_label: Tavily Search  # 必須：UI表示名
    is_team_authorization: true
    tool_parameters:  # 動的値のみ
      query:
        type: mixed
        value: '{{#sys.query#}}'
    tool_configurations:  # 静的設定値
      search_depth: basic
      max_results: 5
      include_answer: 0  # boolean値は0/1
```
```

■優先度
1. 最優先：コンポーネント記述ルール_WEB検索.txt の更新
2. 高優先：クラッシュ事項チェックリスト.md への追加
3. 中優先：品質チェックリスト.md への追加
4. 低優先：全体コーディングルール.md への追加

■補足
- 今回のエラーはすべてtoolノードの実装に関するものでした
- 特にprovider_nameとtool_labelの必須性が現行ルールから漏れていました
- tool_parametersとtool_configurationsの使い分けが不明確でした
- これらの改善により、同様のエラーを防止できます