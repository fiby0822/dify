ルール改修案: エッジ設定の整合性について

作成日: 2025-01-20
対象ファイル: 
- クラッシュ事項チェックリスト.md
- 品質チェックリスト.md

■改修理由
GoogleShpredSheetサンプル.yml（動作確認済み）では、エッジのdataにisInIterationとisInLoopが混在している。
現行ルールではisInLoopの使用を推奨しているが、実際に動作するファイルでは両方が使用されている。

■現状分析

サンプルファイルのエッジ設定：
- 一部のエッジ: isInLoop: false のみ
- 一部のエッジ: isInIteration: false と isInLoop: false の両方

現行ルール：
- クラッシュ事項チェックリスト: isInLoopを使用（isInIterationではない）
- エラー例として「isInIteration is not valid」を挙げている

■改修内容

【1. クラッシュ事項チェックリスト.md】

16.1 エッジのisInIterationエラー の修正:

（現行）
- [ ] **全てのエッジでisInLoopを使用（isInIterationは使用禁止）**

（改修案）
- [ ] **全てのエッジでisInLoopを設定している**
- [ ] **isInIterationが含まれている場合も、isInLoopが必ず設定されている**
- [ ] **新規作成時はisInLoopのみを使用（isInIterationは非推奨）**

注記を追加：
※ 既存の動作確認済みファイルではisInIterationとisInLoopの両方が含まれる場合があります。
  この場合、両方が設定されていても動作に問題はありませんが、
  新規作成時はisInLoopのみを使用することを推奨します。

【2. 品質チェックリスト.md】

0.4 エッジフィールドの確認 の修正:

（現行）
- [ ] すべてのエッジで`data.isInLoop: false`が設定されている（isInIterationではない）

（改修案）
- [ ] すべてのエッジで`data.isInLoop: false`が設定されている
- [ ] 既存ファイルで`isInIteration`が含まれる場合、`isInLoop`も併せて設定されている

■実装ガイドライン

1. 新規作成時：
   ```yaml
   edges:
     - data:
         isInLoop: false  # のみを使用
         sourceType: tool
         targetType: answer
   ```

2. 既存ファイルの扱い：
   ```yaml
   edges:
     - data:
         isInIteration: false  # 残っていても問題なし
         isInLoop: false       # 必須
         sourceType: tool
         targetType: answer
   ```

3. 移行期の対応：
   - 既存ファイルのisInIterationを急いで削除する必要はない
   - 新規作成や更新時にisInLoopのみに統一していく
   - インポートエラーが発生しない限り、両方の存在を許容

■背景説明

isInIterationからisInLoopへの移行は、Difyのバージョンアップに伴う変更と推測されます。
後方互換性のため、現時点では両方の設定が受け入れられていますが、
将来的にはisInLoopに統一される可能性があります。

■チェックポイントの優先順位

1. 必須: isInLoopが設定されていること
2. 推奨: 新規作成時はisInIterationを含めない
3. 許容: 既存ファイルでの両方の存在

この改修により、動作確認済みファイルとの整合性を保ちながら、
将来的な移行に備えた適切なガイドラインを提供できます。