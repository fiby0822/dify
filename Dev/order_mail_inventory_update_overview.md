# 受発注メール要約→在庫更新リスト生成ボット

## アプリ概要

**サービス名**：受発注メール要約→在庫更新リスト生成ボット

**ターゲット**（誰向けのサービスか）：製造業 × 購買部門

**課題**（どんな問題を解決するのか）：メール確認と在庫表更新を手作業で行うため遅延・ミスが発生

**インプット**（何の情報を入力するのか）：受発注メール（本文・PDF）

**プロセス**（インプットした情報をどのように処理するのか）：発注数量／納期抽出→既存CSVと突合→差分生成

**アウトプット**（どのような出力結果になるのか）：更新済み在庫表（CSV）＋変更点サマリー

**必要マテリアル**：
- 商品マスタ（SKU ⇔ 品名変換辞書）
- 納期表現パターン辞書
- 在庫CSVテンプレート
- 抽出精度評価シート

## マテリアル具体例

### 1. 商品マスタ（SKU ⇔ 品名変換辞書）
```
SKU,品名,単位,カテゴリ
A001,M8六角ボルトSUS304,本,ボルト
A002,M10六角ボルトSUS304,本,ボルト
B001,ワッシャーM8,枚,ワッシャー
B002,ワッシャーM10,枚,ワッシャー
C001,スプリングワッシャーM8,枚,ワッシャー
D001,六角ナットM8,個,ナット
D002,六角ナットM10,個,ナット
E001,アルミ板材1000×2000×3t,枚,板材
E002,SUS304板材1000×2000×2t,枚,板材
F001,丸鋼SS400φ20×4000,本,棒材
```

### 2. 納期表現パターン辞書
```
表現パターン,標準化形式,日数計算
即納,当日,0
翌日,翌営業日,1
明日,翌営業日,1
○日後,○営業日後,○
○営業日,○営業日後,○
来週,5営業日後,5
今週中,3営業日後,3
月末,当月末日,可変
○月○日,指定日,絶対日付
至急,翌営業日,1
ASAP,翌営業日,1
```

### 3. 在庫CSVテンプレート
```
SKU,品名,現在庫数,安全在庫,発注点,発注中数量,最終更新日時
A001,M8六角ボルトSUS304,5000,1000,1500,0,2024-01-15 10:00:00
A002,M10六角ボルトSUS304,3000,800,1200,0,2024-01-15 10:00:00
B001,ワッシャーM8,10000,2000,3000,0,2024-01-15 10:00:00
B002,ワッシャーM10,8000,1500,2500,0,2024-01-15 10:00:00
C001,スプリングワッシャーM8,7000,1500,2000,0,2024-01-15 10:00:00
D001,六角ナットM8,6000,1200,1800,0,2024-01-15 10:00:00
D002,六角ナットM10,4000,1000,1500,0,2024-01-15 10:00:00
E001,アルミ板材1000×2000×3t,50,10,15,0,2024-01-15 10:00:00
E002,SUS304板材1000×2000×2t,30,8,12,0,2024-01-15 10:00:00
F001,丸鋼SS400φ20×4000,100,20,30,0,2024-01-15 10:00:00
```

### 4. 抽出精度評価シート
```
評価項目,重要度,評価基準,配点
商品名認識精度,高,完全一致:100%、部分一致:80%、誤認識:0%,30
SKU変換精度,高,正確に変換:100%、変換不可:0%,20
数量抽出精度,高,数値と単位の正確な抽出:100%、数値のみ:50%、抽出失敗:0%,25
納期抽出精度,中,標準化成功:100%、日付抽出のみ:50%、抽出失敗:0%,15
メール構造理解,低,発注/納品区分の正確な判定:100%、誤判定:0%,10
```

### 5. サンプル受発注メール
```
件名: 【発注】ボルト・ナット類の追加発注

お世話になっております。
製造部の山田です。

下記の通り、追加発注をお願いいたします。

発注内容：
1. M8六角ボルトSUS304（A001） - 2000本
   納期：翌営業日
   
2. M10六角ボルトSUS304（A002） - 1500本
   納期：3営業日後
   
3. ワッシャーM8（B001） - 5000枚
   納期：即納希望
   
4. 六角ナットM8（D001） - 3000個
   納期：来週中

配送先：第2工場倉庫
備考：品質証明書を添付してください

よろしくお願いいたします。
```

## 実装ファイル

- **Dify YMLファイル**: `/Users/tatsuya/Documents/01_fiby/09_ゼット/Dev/order_mail_inventory_update.yml`

## ワークフローの構成

1. **開始（start）**: ユーザーからメール入力を受け付ける
2. **メール解析（llm_mail_parser）**: メール内容を解析して発注情報をJSON形式で抽出
3. **JSON→CSV変換（code_json_to_csv）**: JSON形式のデータをCSV形式に変換し、在庫数を更新
4. **在庫更新リスト生成（template_transform_inventory）**: 最終的な出力フォーマットを生成
5. **結果出力（answer）**: 在庫更新リストを表示

## 特徴

- 自然言語で書かれた受発注メールから構造化データを自動抽出
- 商品マスタを参照してSKUコードと品名を相互変換
- 多様な納期表現を標準化形式に変換
- 在庫数の自動更新と変更履歴の記録
- CSV形式での出力により、基幹システムとの連携が容易